<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord Admin - SenVision Optique</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- html2canvas pour g√©n√©ration PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #4895ef;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --success-color: #4ade80;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --sidebar-bg: #0f172a;
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 80px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: var(--dark-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* √âcran de connexion */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: gradientBG 15s ease infinite;
            background-size: 400% 400%;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .login-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            padding: 50px 40px;
            box-shadow: 0 20px 80px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
            text-align: center;
            animation: slideInUp 0.6s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 2.5rem;
            color: white;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .login-title {
            color: var(--dark-color);
            margin-bottom: 15px;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-description {
            color: #64748b;
            margin-bottom: 30px;
            font-size: 1rem;
            line-height: 1.6;
        }

        .login-input-container {
            position: relative;
            margin-bottom: 25px;
        }

        .login-input {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: #f8fafc;
            color: var(--dark-color);
        }

        .login-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
            outline: none;
            background: white;
            transform: translateY(-2px);
        }

        .login-error {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-bottom: 15px;
            display: none;
        }

        .btn-login {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            padding: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s ease;
            color: white;
            width: 100%;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .btn-login:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
        }

        /* Dashboard Container */
        .dashboard-container {
            display: none;
        }

        .dashboard-visible {
            display: block;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            color: white;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-header {
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: white;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-color), var(--primary-light));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo-text {
            font-size: 1.3rem;
            font-weight: 700;
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .logo-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(180deg);
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 14px 25px;
            color: #cbd5e1;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            margin: 5px 15px;
            border-radius: 12px;
            overflow: hidden;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(5px);
        }

        .menu-item.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        .menu-item i {
            font-size: 1.3rem;
            min-width: 24px;
            margin-right: 15px;
            transition: transform 0.3s ease;
        }

        .menu-item:hover i {
            transform: scale(1.1);
        }

        .menu-text {
            transition: opacity 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
        }

        .sidebar.collapsed .menu-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .badge-notification {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            padding: 4px 8px;
            background: var(--danger-color);
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
            color: white;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100vh;
            background: #f1f5f9;
        }

        .main-content.expanded {
            margin-left: var(--sidebar-collapsed-width);
        }

        /* Header */
        .page-header {
            background: white;
            padding: 25px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark-color);
            cursor: pointer;
        }

        .header-title h1 {
            font-size: 1.8rem;
            color: var(--dark-color);
            margin-bottom: 5px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-title p {
            color: #64748b;
            font-size: 0.95rem;
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-box {
            position: relative;
            min-width: 300px;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }

        .search-box input {
            padding: 12px 20px 12px 45px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            width: 100%;
            transition: all 0.3s ease;
            background: #f8fafc;
            font-size: 0.95rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: white;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .stats-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.4s ease;
            border: 1px solid rgba(226, 232, 240, 0.6);
            position: relative;
            overflow: hidden;
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
        }

        .stats-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .card-icon {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: white;
        }

        .icon-sales { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .icon-orders { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .icon-messages { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .icon-revenue { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .icon-clients { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
        .icon-products { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); color: #333; }

        .stats-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-title {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .stats-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--dark-color);
            line-height: 1;
            margin-bottom: 10px;
        }

        .stats-change {
            font-size: 0.85rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
            background: rgba(72, 187, 120, 0.1);
            color: #22c55e;
        }

        .stats-change.down {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        /* Quick Actions */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            text-decoration: none;
            color: var(--dark-color);
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            cursor: pointer;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .action-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .action-text {
            font-weight: 600;
            font-size: 1rem;
            color: #334155;
        }

        /* Chart Card - Version am√©lior√©e */
        .chart-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            border: 1px solid rgba(226, 232, 240, 0.6);
            position: relative;
            overflow: hidden;
        }

        .chart-card.small {
            padding: 20px;
        }

        .chart-card.small .chart-header {
            margin-bottom: 15px;
        }

        .chart-card.small canvas {
            height: 280px !important; /* Augment√© pour plus de visibilit√© */
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .chart-header h3 {
            font-size: 1.2rem;
            color: var(--dark-color);
            margin: 0;
            font-weight: 600;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #64748b;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .chart-tooltip {
            background: white;
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        /* Table Card */
        .table-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        .admin-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .admin-table thead {
            background: #f8fafc;
        }

        .admin-table th {
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            color: #475569;
            border-bottom: 2px solid #e2e8f0;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-table td {
            padding: 18px 20px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
            color: #475569;
        }

        .admin-table tbody tr {
            transition: all 0.3s ease;
        }

        .admin-table tbody tr:hover {
            background: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            display: inline-block;
        }

        .status-pending { background: rgba(245, 158, 11, 0.1); color: #d97706; }
        .status-processing { background: rgba(59, 130, 246, 0.1); color: #2563eb; }
        .status-paid { background: rgba(34, 197, 94, 0.1); color: #16a34a; }
        .status-delivered { background: rgba(139, 92, 246, 0.1); color: #7c3aed; }
        .status-cancelled { background: rgba(239, 68, 68, 0.1); color: #dc2626; }

        /* Dashboard Sections */
        .dashboard-section {
            padding: 30px;
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-section.active {
            display: block;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-left: 4px solid;
            margin-bottom: 10px;
            animation: slideInRight 0.3s ease-out;
            max-width: 350px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success { border-left-color: var(--success-color); }
        .toast-error { border-left-color: var(--danger-color); }
        .toast-warning { border-left-color: var(--warning-color); }
        .toast-info { border-left-color: var(--info-color); }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            padding: 12px 24px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s ease;
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
            color: white;
        }

        /* Bouton Facture */
        .btn-invoice {
            background: linear-gradient(135deg, #0d9488, #0f766e);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-invoice:hover {
            background: linear-gradient(135deg, #0f766e, #115e59);
            color: white;
            transform: translateY(-2px);
        }

        /* Styles pour la facture */
        .invoice-container {
            font-family: 'Arial', sans-serif;
            color: #333;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
            border-bottom: 2px solid #4361ee;
            padding-bottom: 20px;
        }

        .company-info {
            flex: 1;
        }

        .invoice-title {
            text-align: right;
        }

        .company-logo {
            font-size: 24px;
            font-weight: bold;
            color: #4361ee;
            margin-bottom: 10px;
        }

        .invoice-details {
            margin: 30px 0;
            display: flex;
            justify-content: space-between;
        }

        .client-info, .invoice-info {
            width: 45%;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #4361ee;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .invoice-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            font-weight: bold;
            color: #495057;
        }

        .invoice-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }

        .invoice-table tr:last-child td {
            border-bottom: 2px solid #dee2e6;
        }

        .text-right {
            text-align: right;
        }

        .totals-section {
            margin-top: 30px;
            width: 300px;
            margin-left: auto;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
        }

        .grand-total {
            font-size: 18px;
            font-weight: bold;
            color: #4361ee;
            border-top: 2px solid #4361ee;
            padding-top: 10px;
            margin-top: 10px;
        }

        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            font-size: 12px;
            color: #6c757d;
            text-align: center;
        }

        .terms {
            margin-top: 30px;
            font-size: 12px;
            color: #6c757d;
        }

        .stamp {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            border: 2px dashed #4361ee;
            display: inline-block;
            font-style: italic;
            color: #4361ee;
        }

        /* Styles am√©lior√©s pour les cartes produits */
        .product-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.8);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
            border-color: var(--primary-color);
        }

        .product-image {
            position: relative;
            height: 220px;
            overflow: hidden;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
            z-index: 2;
        }

        .product-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .product-info {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .product-info h5 {
            font-size: 1.1rem;
            color: var(--dark-color);
            margin-bottom: 4px;
            line-height: 1.3;
            font-weight: 600;
        }

        .product-info .text-muted {
            font-size: 0.85rem;
            margin-bottom: 8px;
            color: #64748b;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .product-info p {
            font-size: 0.9rem;
            line-height: 1.4;
            color: #64748b;
            margin-bottom: 16px;
            flex: 1;
        }

        .stock-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .stock-high {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }

        .stock-medium {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .stock-low {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            animation: pulse 2s infinite;
        }

        /* Overlay pour les images */
        .product-image::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to top, rgba(255,255,255,0.9), transparent);
            z-index: 1;
        }

        /* Effet de zoom au survol */
        .product-image {
            cursor: pointer;
        }

        .product-image:hover::before {
            content: 'üñ±Ô∏è Voir l\'image';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.8rem;
            z-index: 3;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .product-image:hover::before {
            opacity: 1;
        }

        /* Boutons d'action sur image */
        .product-actions {
            position: absolute;
            bottom: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 2;
        }

        .product-card:hover .product-actions {
            opacity: 1;
            transform: translateY(0);
        }

        .btn-image-action {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-image-action:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        /* Modal pour l'image en grand */
        .product-image-modal .modal-content {
            background: transparent;
            border: none;
        }

        .product-image-modal .modal-body {
            padding: 0;
        }

        .product-image-modal img {
            width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 12px;
        }

        /* Styles pour les images manquantes */
        .product-image img:before {
            content: "üì∑";
            font-size: 3rem;
            color: #cbd5e1;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .product-image img:after {
            content: "Image non disponible";
            font-size: 0.9rem;
            color: #94a3b8;
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
        }

        /* Animation pour les nouvelles images */
        @keyframes fadeInImage {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .product-image img {
            animation: fadeInImage 0.5s ease-out;
        }

        /* Overlay de chargement */
        .product-image.loading {
            position: relative;
        }

        .product-image.loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            z-index: 1;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Styles pour la section comptes */
        .bg-purple {
            background-color: #8b5cf6 !important;
        }

        .bg-teal {
            background-color: #0d9488 !important;
        }

        /* Style pour le badge de d√©monstration */
        .demo-badge {
            animation: pulseBadge 2s infinite;
        }

        @keyframes pulseBadge {
            0% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.1); }
            100% { transform: translateY(-50%) scale(1); }
        }

        /* Styles pour l'impression */
        @media print {
            .sidebar, .page-header, .modal-footer {
                display: none !important;
            }
            
            .modal-body {
                padding: 0 !important;
            }
            
            #invoiceContent {
                max-width: 100% !important;
                padding: 0 !important;
            }
        }

        /* ==================== */
        /* VERSION MOBILE AM√âLIOR√âE */
        /* ==================== */
        @media (max-width: 768px) {
            /* Sidebar mobile */
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
                z-index: 1050;
                box-shadow: 10px 0 30px rgba(0, 0, 0, 0.3);
            }
            
            .sidebar.show {
                transform: translateX(0);
                animation: slideInLeft 0.3s ease-out;
            }
            
            @keyframes slideInLeft {
                from {
                    transform: translateX(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            .sidebar-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1040;
                display: none;
            }
            
            .sidebar-overlay.show {
                display: block;
                animation: fadeIn 0.3s ease-out;
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            /* Header mobile */
            .page-header {
                padding: 20px;
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                position: relative;
            }
            
            .header-title h1 {
                font-size: 1.4rem;
                margin-bottom: 5px;
            }
            
            .header-title p {
                font-size: 0.9rem;
            }
            
            .header-actions {
                width: 100%;
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
                order: 2;
            }
            
            .search-box input {
                padding: 12px 15px 12px 40px;
            }
            
            /* Stats Cards mobile */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .stats-card {
                padding: 20px;
                border-radius: 16px;
            }
            
            .stats-card::before {
                width: 4px;
            }
            
            .card-icon {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
                margin-bottom: 15px;
            }
            
            .stats-value {
                font-size: 1.8rem;
            }
            
            .stats-change {
                font-size: 0.75rem;
                padding: 3px 8px;
            }
            
            /* Quick Actions mobile */
            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .action-card {
                padding: 20px;
                border-radius: 12px;
            }
            
            .action-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .action-text {
                font-size: 0.9rem;
            }
            
            /* Chart Card mobile - AM√âLIOR√â */
            .chart-card {
                padding: 20px;
                border-radius: 16px;
                margin-bottom: 20px;
            }
            
            .chart-card.small {
                padding: 15px;
            }
            
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .chart-header h3 {
                font-size: 1.1rem;
            }
            
            .chart-card.small canvas {
                height: 280px !important; /* Augment√© pour mobile */
            }
            
            /* Chart Container am√©lior√© pour mobile */
            .chart-container {
                min-height: 320px;
            }
            
            /* L√©gende am√©lior√©e pour mobile */
            .chart-legend {
                flex-direction: column;
                gap: 8px;
            }
            
            .legend-item {
                width: 100%;
                justify-content: space-between;
                padding: 8px;
                background: #f8fafc;
                border-radius: 8px;
            }
            
            /* Table Card mobile */
            .table-card {
                padding: 20px;
                border-radius: 16px;
                margin-top: 20px;
                overflow-x: auto;
            }
            
            .admin-table {
                min-width: 600px;
                font-size: 12px; /* R√©duit pour mobile */
            }
            
            .admin-table th,
            .admin-table td {
                padding: 12px 15px;
                font-size: 0.85rem;
            }
            
            /* Am√©lioration des s√©lecteurs de statut pour mobile */
            .status-select {
                font-size: 11px !important;
                min-width: 120px !important;
                padding: 4px 8px !important;
            }
            
            /* Boutons d'action pour mobile */
            .btn-group-sm {
                flex-direction: column;
                gap: 4px;
            }
            
            .btn-group-sm .btn {
                width: 30px;
                height: 30px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Am√©lioration des filtres pour mobile */
            .row.mb-4 {
                gap: 10px;
            }
            
            .row.mb-4 > div {
                margin-bottom: 10px;
            }
            
            .form-select, .form-control {
                font-size: 14px !important; /* Plus lisible sur mobile */
            }
            
            /* Products Grid mobile */
            .product-image {
                height: 180px;
            }
            
            .product-badge {
                top: 8px;
                right: 8px;
                padding: 4px 8px;
                font-size: 0.7rem;
            }
            
            .product-info {
                padding: 15px;
            }
            
            .product-info h5 {
                font-size: 1rem;
            }
            
            .product-price {
                font-size: 1.1rem;
            }
            
            .product-info p {
                font-size: 0.85rem;
            }
            
            /* Dashboard Sections mobile */
            .dashboard-section {
                padding: 20px 15px;
            }
            
            /* Analytics mobile */
            .row > .col-md-6 {
                margin-bottom: 20px;
            }
            
            /* Toast mobile */
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }
            
            .toast {
                max-width: 100%;
                width: 100%;
            }
            
            /* Invoice modal mobile */
            .invoice-details {
                flex-direction: column;
            }
            
            .client-info, .invoice-info {
                width: 100%;
                margin-bottom: 20px;
            }
            
            /* Form elements mobile */
            .form-select, .form-control {
                font-size: 0.9rem;
                padding: 10px 12px;
            }
            
            /* Buttons mobile */
            .btn-primary {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .btn-sm {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            /* Modal mobile */
            .modal-dialog {
                margin: 10px;
            }
            
            .modal-content {
                border-radius: 16px;
            }
            
            /* Date display mobile */
            .date-display {
                font-size: 0.85rem;
            }
            
            /* Stats value pour mobile */
            .stats-value {
                font-size: 1.6rem;
            }
        }

        /* Tr√®s petits mobiles */
        @media (max-width: 480px) {
            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-card {
                padding: 15px;
            }
            
            .stats-value {
                font-size: 1.4rem;
            }
            
            .product-image {
                height: 150px;
            }
            
            .chart-card.small canvas {
                height: 250px !important;
            }
            
            .page-header {
                padding: 15px;
            }
            
            .dashboard-section {
                padding: 15px 10px;
            }
            
            .admin-table {
                font-size: 11px;
            }
        }

        /* Tablettes */
        @media (min-width: 769px) and (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .sidebar {
                width: 250px;
            }
            
            .main-content {
                margin-left: 250px;
            }
            
            .search-box {
                min-width: 250px;
            }
            
            .product-image {
                height: 200px;
            }
            
            .chart-card.small canvas {
                height: 250px !important;
            }
        }

        /* Responsive g√©n√©ral */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- √âcran de connexion -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-icon">
                <i class="bi bi-shield-lock"></i>
            </div>
            
            <h2 class="login-title">Connexion Administrateur</h2>
            <p class="login-description">
                Bienvenue sur le tableau de bord SenVision Optique. Acc√®s strictement r√©serv√© au personnel autoris√©.
            </p>
            
            <div class="login-error" id="loginError">
                <i class="bi bi-exclamation-triangle me-1"></i>
                <span id="errorMessage">Identifiants incorrects</span>
            </div>
            
            <div class="login-input-container">
                <input type="text" 
                       class="login-input" 
                       id="username"
                       placeholder="Nom d'utilisateur"
                       autocomplete="username"
                       autofocus>
            </div>
            
            <div class="login-input-container">
                <input type="password" 
                       class="login-input" 
                       id="password"
                       placeholder="Mot de passe"
                       autocomplete="current-password">
                <button type="button" class="password-toggle" onclick="togglePassword()">
                    <i class="bi bi-eye"></i>
                </button>
            </div>
            
            <button class="btn btn-login" onclick="login()" id="loginButton">
                <i class="bi bi-box-arrow-in-right me-2"></i>
                <span id="loginText">Se Connecter</span>
                <span id="loginSpinner" style="display: none;">
                    <span class="spinner-border spinner-border-sm" role="status"></span>
                </span>
            </button>
            
            <p class="text-muted mt-3 small">
                <i class="bi bi-info-circle me-1"></i>
                Toute tentative d'acc√®s non autoris√© sera signal√©e
            </p>
        </div>
    </div>

    <!-- Dashboard principal -->
    <div class="dashboard-container" id="dashboardContainer">
        <!-- Overlay pour sidebar mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="hideMobileSidebar()"></div>
        
        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">
                        <i class="bi bi-eyeglasses"></i>
                    </div>
                    <span class="logo-text">SenVision</span>
                </a>
                <button class="toggle-btn" id="toggleSidebar">
                    <i class="bi bi-chevron-left"></i>
                </button>
            </div>

            <div class="sidebar-menu">
                <a href="#dashboard" class="menu-item active" data-section="dashboard">
                    <i class="bi bi-speedometer2"></i>
                    <span class="menu-text">Tableau de Bord</span>
                </a>
                <a href="#orders" class="menu-item" data-section="orders">
                    <i class="bi bi-cart-check"></i>
                    <span class="menu-text">Commandes</span>
                    <span class="badge-notification demo-badge" id="ordersBadge">2</span>
                </a>
                <a href="#products" class="menu-item" data-section="products">
                    <i class="bi bi-eyeglasses"></i>
                    <span class="menu-text">Produits</span>
                </a>
                <a href="#customers" class="menu-item" data-section="customers">
                    <i class="bi bi-people"></i>
                    <span class="menu-text">Clients</span>
                </a>
                <a href="#accounts" class="menu-item" data-section="accounts">
                    <i class="bi bi-cash-stack"></i>
                    <span class="menu-text">Comptes</span>
                </a>
                <a href="#messages" class="menu-item" data-section="messages">
                    <i class="bi bi-chat"></i>
                    <span class="menu-text">Messages</span>
                    <span class="badge-notification" id="messagesBadge" style="display: none;">0</span>
                </a>
                <a href="#inventory" class="menu-item" data-section="inventory">
                    <i class="bi bi-box-seam"></i>
                    <span class="menu-text">Inventaire</span>
                </a>
                <a href="#analytics" class="menu-item" data-section="analytics">
                    <i class="bi bi-graph-up"></i>
                    <span class="menu-text">Analytics</span>
                </a>
                <div class="mt-auto">
                    <a href="marques.html" class="menu-item" target="_blank">
                        <i class="bi bi-shop"></i>
                        <span class="menu-text">Voir la Boutique</span>
                        <i class="bi bi-box-arrow-up-right ms-auto" style="font-size: 0.8rem;"></i>
                    </a>
                    <a href="#settings" class="menu-item" data-section="settings">
                        <i class="bi bi-gear"></i>
                        <span class="menu-text">Param√®tres</span>
                    </a>
                    <a href="#logout" class="menu-item text-danger" onclick="logout()">
                        <i class="bi bi-box-arrow-right"></i>
                        <span class="menu-text">D√©connexion</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Page Header -->
            <header class="page-header">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="bi bi-list"></i>
                </button>
                <div class="header-title">
                    <h1 id="pageTitle">Tableau de Bord</h1>
                    <div>
                        <p id="welcomeMessage">Bienvenue, Administrateur</p>
                        <div class="date-display">
                            <i class="bi bi-calendar"></i>
                            <span id="currentDate">Chargement...</span>
                        </div>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i class="bi bi-search"></i>
                        <input type="text" placeholder="Rechercher..." id="globalSearch">
                    </div>
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        <i class="bi bi-plus-circle me-2"></i>Nouveau Produit
                    </button>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboard" class="dashboard-section active">
                <!-- Quick Stats - Chiffres align√©s avec les factures -->
                <div class="stats-grid">
                    <div class="stats-card">
                        <div class="card-icon icon-sales">
                            <i class="bi bi-currency-exchange"></i>
                        </div>
                        <div class="stats-info">
                            <div>
                                <div class="stats-title">Ventes Aujourd'hui</div>
                                <div class="stats-value" id="todaySales">0 F</div>
                            </div>
                            <div class="stats-change">
                                <i class="bi bi-arrow-up"></i> 12.5%
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="card-icon icon-orders">
                            <i class="bi bi-cart"></i>
                        </div>
                        <div class="stats-info">
                            <div>
                                <div class="stats-title">Nouvelles Commandes</div>
                                <div class="stats-value" id="newOrdersCount">0</div>
                            </div>
                            <div class="stats-change">
                                <i class="bi bi-arrow-up"></i> 8.2%
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="card-icon icon-clients">
                            <i class="bi bi-people"></i>
                        </div>
                        <div class="stats-info">
                            <div>
                                <div class="stats-title">Nouveaux Clients</div>
                                <div class="stats-value" id="newCustomersCount">0</div>
                            </div>
                            <div class="stats-change">
                                <i class="bi bi-arrow-up"></i> 5.3%
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="card-icon icon-revenue">
                            <i class="bi bi-graph-up"></i>
                        </div>
                        <div class="stats-info">
                            <div>
                                <div class="stats-title">Revenu du Mois</div>
                                <div class="stats-value" id="monthlyRevenue">0 F</div>
                            </div>
                            <div class="stats-change">
                                <i class="bi bi-arrow-up"></i> 15.3%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions-grid">
                    <div class="action-card" onclick="showSection('orders')">
                        <div class="action-icon">
                            <i class="bi bi-cart-plus"></i>
                        </div>
                        <div class="action-text">G√©rer Commandes</div>
                    </div>
                    <div class="action-card" onclick="showAddProductModal()">
                        <div class="action-icon">
                            <i class="bi bi-plus-lg"></i>
                        </div>
                        <div class="action-text">Ajouter Produit</div>
                    </div>
                    <div class="action-card" onclick="showSection('customers')">
                        <div class="action-icon">
                            <i class="bi bi-person-plus"></i>
                        </div>
                        <div class="action-text">Voir Clients</div>
                    </div>
                    <div class="action-card" onclick="showSection('messages')">
                        <div class="action-icon">
                            <i class="bi bi-chat-dots"></i>
                        </div>
                        <div class="action-text">Messages</div>
                    </div>
                </div>

                <!-- Top Categories Chart - Version am√©lior√©e -->
                <div class="chart-card small">
                    <div class="chart-header">
                        <h3>Top Cat√©gories de Produits</h3>
                        <div class="d-flex align-items-center gap-3">
                            <select class="form-select form-select-sm" style="width: auto; font-size: 0.85rem;" id="chartPeriod">
                                <option>Ce mois</option>
                                <option>Trimestre</option>
                                <option>Ann√©e</option>
                            </select>
                            <button class="btn btn-sm btn-outline-primary" onclick="refreshCategoriesChart()">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container" style="position: relative; min-height: 280px;">
                        <canvas id="categoriesChart" height="280"></canvas>
                    </div>
                    <div class="chart-legend mt-3" id="categoriesLegend">
                        <!-- L√©gende g√©n√©r√©e dynamiquement -->
                    </div>
                    <div class="mt-3 text-end">
                        <small class="text-muted">Total: <span id="totalCategoriesCount">0</span> produits</small>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="table-card mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Commandes R√©centes</h3>
                        <button class="btn btn-outline-primary btn-sm" onclick="showSection('orders')">
                            Voir tout <i class="bi bi-arrow-right ms-1"></i>
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>R√©f√©rence</th>
                                    <th>Client</th>
                                    <th>Date</th>
                                    <th>Montant</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentOrdersTable">
                                <!-- Charg√© dynamiquement -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders" class="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Gestion des Commandes</h2>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-success" onclick="exportOrders('excel')">
                            <i class="bi bi-file-excel me-2"></i>Excel
                        </button>
                        <button class="btn btn-primary" onclick="generateOrdersReport()">
                            <i class="bi bi-file-earmark-pdf me-2"></i>Rapport PDF
                        </button>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-3">
                        <select class="form-select" id="orderStatusFilter">
                            <option value="">Tous les statuts</option>
                            <option value="new">Nouvelle</option>
                            <option value="processing">En traitement</option>
                            <option value="paid">Pay√©e</option>
                            <option value="delivered">Livr√©e</option>
                            <option value="cancelled">Annul√©e</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="date" class="form-control" id="orderDateFilter">
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-primary w-100" onclick="filterOrders()">
                            <i class="bi bi-funnel me-2"></i>Filtrer
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-secondary w-100" onclick="resetFilters()">
                            <i class="bi bi-x-circle me-2"></i>R√©initialiser
                        </button>
                    </div>
                </div>

                <div class="table-card">
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>R√©f√©rence</th>
                                    <th>Client</th>
                                    <th>T√©l√©phone</th>
                                    <th>Date</th>
                                    <th>Montant</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTable">
                                <!-- Les commandes seront charg√©es ici -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section id="products" class="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Gestion des Produits</h2>
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        <i class="bi bi-plus-circle me-2"></i>Ajouter Produit
                    </button>
                </div>

                <div class="row mb-4">
                    <div class="col-md-4">
                        <select class="form-select" id="productCategoryFilter">
                            <option value="">Toutes cat√©gories</option>
                            <option value="lunettes">Lunettes de vue</option>
                            <option value="soleil">Lunettes soleil</option>
                            <option value="lentilles">Lentilles</option>
                            <option value="accessoires">Accessoires</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="productBrandFilter">
                            <option value="">Toutes marques</option>
                            <option value="rayban">Ray-Ban</option>
                            <option value="oakley">Oakley</option>
                            <option value="gucci">Gucci</option>
                            <option value="acuvue">Acuvue</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary w-100" onclick="filterProducts()">
                            <i class="bi bi-funnel me-2"></i>Filtrer
                        </button>
                    </div>
                </div>

                <div class="row" id="productsGrid">
                    <!-- Les produits seront charg√©s ici -->
                </div>
            </section>

            <!-- Customers Section -->
            <section id="customers" class="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Gestion des Clients</h2>
                    <button class="btn btn-primary" onclick="exportCustomers()">
                        <i class="bi bi-download me-2"></i>Exporter
                    </button>
                </div>

                <div class="table-card">
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>T√©l√©phone</th>
                                    <th>Commandes</th>
                                    <th>Total d√©pens√©</th>
                                    <th>Type</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customersTable">
                                <!-- Les clients seront charg√©s ici -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Accounts Section -->
            <section id="accounts" class="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Gestion des Comptes</h2>
                    <div class="d-flex gap-2">
                        <button class="btn btn-success" onclick="showAddAccountModal()">
                            <i class="bi bi-plus-circle me-2"></i>Nouvelle Transaction
                        </button>
                        <button class="btn btn-primary" onclick="generateAccountsReport()">
                            <i class="bi bi-file-earmark-bar-graph me-2"></i>Rapport Comptable
                        </button>
                    </div>
                </div>

                <!-- Comptes Stats -->
                <div class="stats-grid mb-4">
                    <div class="stats-card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">
                            <i class="bi bi-arrow-down-circle"></i>
                        </div>
                        <div class="stats-info">
                            <div>
                                <div class="stats-title">Recettes Total</div>
                                <div class="stats-value" id="totalRevenue">0 F</div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <i class="bi bi-arrow-up-circle"></i>
                        </div>
                        <div class="stats-info">
                            <div>
                                <div class="stats-title">D√©penses Total</div>
                                <div class="stats-value" id="totalExpenses">0 F</div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                            <i class="bi bi-cash-coin"></i>
                        </div>
                        <div class="stats-info">
                            <div>
                                <div class="stats-title">Solde Actuel</div>
                                <div class="stats-value" id="currentBalance">0 F</div>
                            </div>
                            <div class="stats-change">
                                <i class="bi bi-graph-up"></i> 8.5%
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                            <i class="bi bi-calendar-check"></i>
                        </div>
                        <div class="stats-info">
                            <div>
                                <div class="stats-title">Transactions du Mois</div>
                                <div class="stats-value" id="monthlyTransactions">0</div>
                            </div>
                            <div class="stats-change">
                                <i class="bi bi-arrow-up"></i> 12.3%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tableau des transactions -->
                <div class="table-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Transactions R√©centes</h3>
                        <button class="btn btn-outline-primary btn-sm" onclick="exportAccounts('csv')">
                            <i class="bi bi-download me-2"></i>Exporter CSV
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>R√©f√©rence</th>
                                    <th>Description</th>
                                    <th>Cat√©gorie</th>
                                    <th>Type</th>
                                    <th>Montant</th>
                                    <th>Mode Paiement</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="accountsTable">
                                <!-- Les transactions seront charg√©es ici -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Messages Section -->
            <section id="messages" class="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Messages des Clients</h2>
                    <button class="btn btn-primary" onclick="markAllAsRead()">
                        <i class="bi bi-check-all me-2"></i>Tout marquer comme lu
                    </button>
                </div>

                <div id="messagesList">
                    <!-- Les messages seront charg√©s ici -->
                </div>
            </section>

            <!-- Inventory Section -->
            <section id="inventory" class="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Gestion de l'Inventaire</h2>
                    <button class="btn btn-primary" onclick="showLowStockAlert()">
                        <i class="bi bi-exclamation-triangle me-2"></i>Alertes Stock
                    </button>
                </div>

                <div class="table-card">
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Produit</th>
                                    <th>SKU</th>
                                    <th>Stock Actuel</th>
                                    <th>Stock Minimum</th>
                                    <th>Status</th>
                                    <th>Derni√®re mise √† jour</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable">
                                <!-- L'inventaire sera charg√© ici -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Analytics & Rapports</h2>
                    <button class="btn btn-primary" onclick="generateAnalyticsReport()">
                        <i class="bi bi-file-earmark-bar-graph me-2"></i>Rapport Complet
                    </button>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-card small">
                            <h3 class="mb-4">Ventes par Mois</h3>
                            <canvas id="monthlySalesChart" height="180"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-card small">
                            <h3 class="mb-4">Top Produits</h3>
                            <canvas id="topProductsChart" height="180"></canvas>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="chart-card">
                            <h3 class="mb-4">Statistiques Cl√©s</h3>
                            <div class="row" id="analyticsStats">
                                <!-- Charg√© dynamiquement -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Param√®tres</h2>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-4">
                                    <i class="bi bi-gear me-2"></i>Param√®tres G√©n√©raux
                                </h5>
                                <div class="mb-3">
                                    <label class="form-label">Nom de la boutique</label>
                                    <input type="text" class="form-control" value="SenVision Optique">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email de contact</label>
                                    <input type="email" class="form-control" value="contact@senvision.sn">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">T√©l√©phone</label>
                                    <input type="text" class="form-control" value="+221 33 123 45 67">
                                </div>
                                <button class="btn btn-primary">Enregistrer</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-4">
                                    <i class="bi bi-shield-lock me-2"></i>S√©curit√©
                                </h5>
                                <div class="mb-3">
                                    <label class="form-label">Changer le mot de passe admin</label>
                                    <input type="password" class="form-control" placeholder="Nouveau mot de passe" id="newPassword">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Confirmer le mot de passe</label>
                                    <input type="password" class="form-control" placeholder="Confirmer le mot de passe" id="confirmPassword">
                                </div>
                                <button class="btn btn-primary" onclick="changePassword()">
                                    <i class="bi bi-key me-2"></i>Changer le mot de passe
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal Facture -->
    <div class="modal fade" id="invoiceModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-receipt me-2"></i>Facture #<span id="invoiceNumber"></span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="invoiceContent" style="background: white; padding: 30px; max-width: 800px; margin: 0 auto;">
                        <!-- Contenu de la facture g√©n√©r√© dynamiquement -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary" onclick="downloadInvoicePDF()">
                        <i class="bi bi-download me-2"></i>T√©l√©charger PDF
                    </button>
                    <button type="button" class="btn btn-success" onclick="printInvoice()">
                        <i class="bi bi-printer me-2"></i>Imprimer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Image Produit -->
    <div class="modal fade" id="productImageModal" tabindex="-1" aria-hidden="true">
        <!-- Le contenu est g√©n√©r√© dynamiquement -->
    </div>

    <!-- Modals Comptes -->
    <div class="modal fade" id="addAccountModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-plus-circle me-2"></i>Nouvelle Transaction
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="accountForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Type de transaction *</label>
                                <select class="form-select" id="transactionType" required onchange="toggleTransactionFields()">
                                    <option value="">S√©lectionner</option>
                                    <option value="income">Recette</option>
                                    <option value="expense">D√©pense</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Cat√©gorie *</label>
                                <select class="form-select" id="transactionCategory" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="sales">Ventes</option>
                                    <option value="purchases">Achats produits</option>
                                    <option value="salary">Salaires</option>
                                    <option value="rent">Loyer</option>
                                    <option value="utilities">√âlectricit√©/Eau</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="other">Autres</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date *</label>
                                <input type="date" class="form-control" id="transactionDate" required value="${new Date().toISOString().split('T')[0]}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Montant (FCFA) *</label>
                                <input type="number" class="form-control" id="transactionAmount" min="0" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Mode de paiement *</label>
                                <select class="form-select" id="transactionPaymentMethod" required>
                                    <option value="cash">Esp√®ces</option>
                                    <option value="mobile_money">Mobile Money</option>
                                    <option value="bank_transfer">Virement bancaire</option>
                                    <option value="check">Ch√®que</option>
                                    <option value="card">Carte bancaire</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">R√©f√©rence</label>
                                <input type="text" class="form-control" id="transactionReference" placeholder="Num√©ro de facture, r√©f√©rence...">
                            </div>
                        </div>
                        
                        <div class="mb-3" id="customerField" style="display: none;">
                            <label class="form-label">Client</label>
                            <select class="form-select" id="transactionCustomer">
                                <option value="">S√©lectionner un client</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" id="transactionDescription" rows="3" required placeholder="D√©crire la transaction..."></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Pi√®ce jointe (facultatif)</label>
                                <input type="file" class="form-control" id="transactionAttachment" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="transactionStatus">
                                    <option value="pending">En attente</option>
                                    <option value="completed" selected>Compl√©t√©</option>
                                    <option value="cancelled">Annul√©</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="saveTransaction()">
                        <i class="bi bi-save me-2"></i>Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ajout Produit -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-plus-circle me-2"></i>Ajouter un Produit
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom du produit *</label>
                                <input type="text" class="form-control" id="productName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">SKU *</label>
                                <input type="text" class="form-control" id="productSKU" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Cat√©gorie *</label>
                                <select class="form-select" id="productCategory" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="lunettes">Lunettes de vue</option>
                                    <option value="soleil">Lunettes soleil</option>
                                    <option value="lentilles">Lentilles</option>
                                    <option value="accessoires">Accessoires</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Marque *</label>
                                <select class="form-select" id="productBrand" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="Ray-Ban">Ray-Ban</option>
                                    <option value="Oakley">Oakley</option>
                                    <option value="Gucci">Gucci</option>
                                    <option value="Acuvue">Acuvue</option>
                                    <option value="Autre">Autre</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Prix (FCFA) *</label>
                                <input type="number" class="form-control" id="productPrice" min="0" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Stock initial *</label>
                                <input type="number" class="form-control" id="productStock" min="0" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Image URL (facultatif)</label>
                                <input type="url" class="form-control" id="productImage" placeholder="https://example.com/image.jpg">
                                <small class="text-muted">Laissez vide pour utiliser une image par d√©faut</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="saveProduct()">
                        <i class="bi bi-save me-2"></i>Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ============================================
        // CONFIGURATION DE S√âCURIT√â
        // ============================================
        const ADMIN_CONFIG = {
            username: "admin",
            password: "SenVision2026!",
            sessionTimeout: 30
        };

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let currentSection = 'dashboard';
        let charts = {};
        let loginAttempts = 0;
        let sessionTimer;
        let currentInvoiceData = null;
        
        // Donn√©es r√©elles depuis localStorage
        let realOrders = [];
        let realProducts = [];
        let realCustomers = [];
        
        // Donn√©es comptes
        let accounts = JSON.parse(localStorage.getItem('senvision-accounts')) || [];
        let suppliers = JSON.parse(localStorage.getItem('senvision-suppliers')) || [];

        // ============================================
        // INITIALISATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            showLoginScreen();
            initLoginScreen();
            updateCurrentDate();
            
            // Initialiser les √©v√©nements tactiles pour mobile
            initMobileEvents();
        });

        // Initialiser les √©v√©nements pour mobile
        function initMobileEvents() {
            // Redimensionnement de l'√©cran
            window.addEventListener('resize', function() {
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('collapsed');
                    document.getElementById('mainContent').classList.remove('expanded');
                }
            });
            
            // Gestion du clavier virtuel
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    setTimeout(() => {
                        this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            });
        }

        function showLoginScreen() {
            document.getElementById('dashboardContainer').classList.remove('dashboard-visible');
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            
            localStorage.removeItem('senvision_session');
            if (sessionTimer) {
                clearInterval(sessionTimer);
            }
        }

        function initLoginScreen() {
            const passwordInput = document.getElementById('password');
            const usernameInput = document.getElementById('username');
            const loginButton = document.getElementById('loginButton');
            
            // Focus sur le champ username
            setTimeout(() => {
                usernameInput.focus();
                // Pour mobile, assurez-vous que le clavier s'ouvre
                usernameInput.setAttribute('inputmode', 'text');
            }, 500);
            
            // Gestion de la touche Entr√©e
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    login();
                }
            });
            
            usernameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('password').focus();
                }
            });
            
            // √âv√©nement tactile pour mobile
            loginButton.addEventListener('touchstart', function(e) {
                e.preventDefault();
                this.style.transform = 'scale(0.95)';
                this.style.transition = 'transform 0.1s';
            }, { passive: false });
            
            loginButton.addEventListener('touchend', function(e) {
                e.preventDefault();
                this.style.transform = '';
                login();
            }, { passive: false });
            
            // Gestion du clavier mobile
            usernameInput.addEventListener('focus', function() {
                setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 100);
            });
            
            passwordInput.addEventListener('focus', function() {
                setTimeout(() => {
                    const loginCard = document.querySelector('.login-card');
                    if (loginCard) {
                        loginCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            });
            
            // Debug logging
            loginButton.addEventListener('click', function() {
                console.log('Bouton cliqu√© sur mobile');
            });
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateStr = now.toLocaleDateString('fr-FR', options);
            document.getElementById('currentDate').textContent = dateStr;
        }

        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.querySelector('.password-toggle i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.classList.remove('bi-eye');
                toggleBtn.classList.add('bi-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleBtn.classList.remove('bi-eye-slash');
                toggleBtn.classList.add('bi-eye');
            }
        }

        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');
            const loginText = document.getElementById('loginText');
            const loginSpinner = document.getElementById('loginSpinner');
            
            // Debug pour mobile
            console.log('Tentative de connexion mobile - Username:', username, 'Password:', password);
            
            // Validation des champs
            if (!username || !password) {
                showLoginError("Veuillez remplir tous les champs");
                // Animation pour mobile
                if (!username) {
                    document.getElementById('username').style.borderColor = 'var(--danger-color)';
                    document.getElementById('username').focus();
                } else {
                    document.getElementById('password').style.borderColor = 'var(--danger-color)';
                    document.getElementById('password').focus();
                }
                return;
            }
            
            // Reset les bordures d'erreur
            document.getElementById('username').style.borderColor = '';
            document.getElementById('password').style.borderColor = '';
            
            // Afficher l'indicateur de chargement
            loginButton.disabled = true;
            loginText.textContent = 'Connexion...';
            loginSpinner.style.display = 'inline-block';
            
            // Simuler un d√©lai pour l'effet visuel (important pour mobile)
            setTimeout(() => {
                if (username === ADMIN_CONFIG.username && password === ADMIN_CONFIG.password) {
                    document.getElementById('loginError').style.display = 'none';
                    createSession();
                    showDashboard();
                    loginAttempts = 0;
                    showToast("Connexion r√©ussie !", "success");
                } else {
                    loginButton.disabled = false;
                    loginText.textContent = 'Se Connecter';
                    loginSpinner.style.display = 'none';
                    
                    loginAttempts++;
                    const remainingAttempts = 3 - loginAttempts;
                    
                    if (remainingAttempts > 0) {
                        showLoginError(`Identifiants incorrects. ${remainingAttempts} tentative(s) restante(s).`);
                    } else {
                        showLoginError("Trop de tentatives √©chou√©es. Veuillez r√©essayer plus tard.");
                        loginButton.disabled = true;
                        
                        setTimeout(() => {
                            loginButton.disabled = false;
                            loginAttempts = 0;
                            showLoginError("");
                        }, 300000);
                    }
                }
            }, 500); // Petit d√©lai pour l'effet visuel
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            const errorMessage = document.getElementById('errorMessage');
            
            console.log('Erreur de connexion mobile:', message); // Debug
            
            if (message) {
                errorMessage.textContent = message;
                errorDiv.style.display = 'block';
                // Animation pour mobile
                errorDiv.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    errorDiv.style.transform = 'scale(1)';
                }, 300);
            } else {
                errorDiv.style.display = 'none';
            }
        }

        function createSession() {
            const sessionData = {
                username: ADMIN_CONFIG.username,
                loginTime: new Date().getTime(),
                expires: new Date().getTime() + (ADMIN_CONFIG.sessionTimeout * 60000)
            };
            
            localStorage.setItem('senvision_session', JSON.stringify(sessionData));
            startSessionTimer();
        }

        function startSessionTimer() {
            if (sessionTimer) {
                clearInterval(sessionTimer);
            }
            
            sessionTimer = setInterval(() => {
                const sessionData = localStorage.getItem('senvision_session');
                
                if (!sessionData) {
                    logout();
                    return;
                }
                
                const session = JSON.parse(sessionData);
                const now = new Date().getTime();
                const remainingTime = session.expires - now;
                
                if (remainingTime < 300000 && remainingTime > 299000) {
                    showToast("Session expirera dans 5 minutes", "warning");
                }
                
                if (now > session.expires) {
                    logout();
                }
            }, 60000);
        }

        function logout() {
            localStorage.removeItem('senvision_session');
            
            if (sessionTimer) {
                clearInterval(sessionTimer);
            }
            
            showLoginScreen();
            
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('loginButton').disabled = false;
            
            loginAttempts = 0;
            
            showToast("D√©connexion r√©ussie", "info");
        }

        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!newPassword || !confirmPassword) {
                showToast("Veuillez remplir tous les champs", "error");
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast("Les mots de passe ne correspondent pas", "error");
                return;
            }
            
            if (newPassword.length < 8) {
                showToast("Le mot de passe doit contenir au moins 8 caract√®res", "error");
                return;
            }
            
            ADMIN_CONFIG.password = newPassword;
            
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            showToast("Mot de passe chang√© avec succ√®s", "success");
        }

        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboardContainer').classList.add('dashboard-visible');
            document.getElementById('dashboardContainer').style.display = 'block';
            
            document.getElementById('welcomeMessage').textContent = `Bienvenue, ${ADMIN_CONFIG.username}`;
            
            initDashboard();
            loadDashboardData();
            initCharts();
            
            // Focus sur le contenu principal pour mobile
            setTimeout(() => {
                document.getElementById('mainContent').focus();
            }, 100);
        }

        function initDashboard() {
            // Sidebar toggle
            document.getElementById('toggleSidebar').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('collapsed');
                document.getElementById('mainContent').classList.toggle('expanded');
            });

            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                showMobileSidebar();
            });

            // Menu items
            document.querySelectorAll('.menu-item[data-section]').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (this.getAttribute('href') === '#') {
                        e.preventDefault();
                    }
                    showSection(this.getAttribute('data-section'));
                    hideMobileSidebar();
                });
            });

            // Global search
            const searchInput = document.getElementById('globalSearch');
            searchInput.addEventListener('input', function() {
                performGlobalSearch(this.value);
            });

            // Click outside to close mobile sidebar
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768) {
                    const sidebar = document.getElementById('sidebar');
                    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                    if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target) && sidebar.classList.contains('show')) {
                        hideMobileSidebar();
                    }
                }
            });
        }

        function showMobileSidebar() {
            document.getElementById('sidebar').classList.add('show');
            document.getElementById('sidebarOverlay').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function hideMobileSidebar() {
            document.getElementById('sidebar').classList.remove('show');
            document.getElementById('sidebarOverlay').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        function showSection(sectionId) {
            currentSection = sectionId;
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.menu-item[data-section="${sectionId}"]`).classList.add('active');
            
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            updatePageTitle(sectionId);
            loadSectionData(sectionId);
            
            // Scroll vers le haut pour mobile
            if (window.innerWidth <= 768) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updatePageTitle(sectionId) {
            const titles = {
                'dashboard': 'Tableau de Bord',
                'orders': 'Commandes',
                'products': 'Produits',
                'customers': 'Clients',
                'accounts': 'Comptes',
                'messages': 'Messages',
                'inventory': 'Inventaire',
                'analytics': 'Analytics',
                'settings': 'Param√®tres'
            };
            
            document.getElementById('pageTitle').textContent = titles[sectionId] || 'Dashboard';
        }

        function loadDashboardData() {
            loadRealData();
            updateStats();
            loadRecentOrders();
            updateNotificationBadges();
        }

        function loadRealData() {
            realOrders = JSON.parse(localStorage.getItem('senvision-orders')) || [];
            realProducts = JSON.parse(localStorage.getItem('senvision-products')) || [];
            extractCustomersFromOrders();
            
            // Charger les donn√©es comptes
            accounts = JSON.parse(localStorage.getItem('senvision-accounts')) || [];
            suppliers = JSON.parse(localStorage.getItem('senvision-suppliers')) || [];
        }

        function extractCustomersFromOrders() {
            const customersMap = new Map();
            
            realOrders.forEach(order => {
                if (order.clientPhone) {
                    if (!customersMap.has(order.clientPhone)) {
                        customersMap.set(order.clientPhone, {
                            id: order.clientPhone,
                            name: order.clientName || 'Client',
                            email: order.clientEmail || '',
                            phone: order.clientPhone,
                            totalOrders: 0,
                            totalSpent: 0,
                            firstOrder: order.date
                        });
                    }
                    
                    const customer = customersMap.get(order.clientPhone);
                    customer.totalOrders++;
                    customer.totalSpent += order.total || 0;
                }
            });
            
            realCustomers = Array.from(customersMap.values());
        }

        function updateStats() {
            const today = new Date().toDateString();
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            
            const todaySales = realOrders
                .filter(order => {
                    const orderDate = new Date(order.date || order.timestamp);
                    return orderDate.toDateString() === today;
                })
                .reduce((sum, order) => sum + (order.total || 0), 0);
            
            const newOrders = realOrders.filter(order => order.status === 'new').length;
            
            const newCustomers = realOrders
                .filter(order => {
                    const orderDate = new Date(order.date || order.timestamp);
                    return orderDate.toDateString() === today;
                })
                .length;
            
            const monthlyRevenue = realOrders
                .filter(order => {
                    const orderDate = new Date(order.date || order.timestamp);
                    return orderDate.getMonth() === thisMonth && orderDate.getFullYear() === thisYear;
                })
                .reduce((sum, order) => sum + (order.total || 0), 0);
            
            document.getElementById('todaySales').textContent = formatNumber(todaySales) + ' F';
            document.getElementById('newOrdersCount').textContent = newOrders;
            document.getElementById('newCustomersCount').textContent = newCustomers;
            document.getElementById('monthlyRevenue').textContent = formatNumber(monthlyRevenue) + ' F';
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getDateFromTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('fr-FR');
        }

        function getStatusText(status) {
            const statusMap = {
                'new': 'Nouvelle',
                'processing': 'En traitement',
                'paid': 'Pay√©e',
                'delivered': 'Livr√©e',
                'cancelled': 'Annul√©e'
            };
            return statusMap[status] || status;
        }

        function getPaymentMethodText(method) {
            switch(method) {
                case 'cod': return 'Paiement √† la livraison';
                case 'mobile_money': return 'Mobile Money';
                case 'bank': return 'Virement bancaire';
                default: return method || 'Non sp√©cifi√©';
            }
        }

        function loadSectionData(sectionId) {
            loadRealData();
            
            switch(sectionId) {
                case 'orders':
                    loadOrdersTable();
                    break;
                case 'products':
                    loadProductsGrid();
                    break;
                case 'customers':
                    loadCustomersTable();
                    break;
                case 'accounts':
                    loadAccountsData();
                    break;
                case 'messages':
                    loadMessagesList();
                    break;
                case 'inventory':
                    loadInventoryTable();
                    break;
                case 'analytics':
                    loadAnalyticsData();
                    break;
            }
            
            updateNotificationBadges();
        }

        function updateNotificationBadges() {
            // Pour d√©monstration, on affiche toujours "2" sur Commandes
            const ordersBadge = document.getElementById('ordersBadge');
            const messagesBadge = document.getElementById('messagesBadge');
            
            // Toujours afficher "2" sur Commandes pour la d√©monstration
            ordersBadge.textContent = '2';
            ordersBadge.style.display = 'flex';
            
            // Masquer le badge Messages s'il est √† 0
            if (messagesBadge.textContent === '0') {
                messagesBadge.style.display = 'none';
            }
        }

        function initCharts() {
            initCategoriesChart();
        }

        function initCategoriesChart() {
            const categoriesCtx = document.getElementById('categoriesChart');
            if (!categoriesCtx) return;
            
            // Donn√©es de d√©monstration enrichies
            const categoriesData = {
                'Lunettes de vue': 45,
                'Lunettes soleil': 32,
                'Lentilles': 18,
                'Accessoires': 12,
                'Montures enfants': 8,
                'Verres progressifs': 15,
                'Montures sport': 7
            };
            
            // Calcul du total
            const total = Object.values(categoriesData).reduce((a, b) => a + b, 0);
            document.getElementById('totalCategoriesCount').textContent = total;
            
            // Couleurs pour le graphique
            const colors = [
                '#4361ee', '#4895ef', '#4cc9f0', '#3a0ca3', 
                '#7209b7', '#f72585', '#4cc9f0', '#560bad'
            ];
            
            // Pr√©paration des donn√©es
            const labels = Object.keys(categoriesData);
            const data = Object.values(categoriesData);
            const backgroundColors = colors.slice(0, labels.length);
            
            // Cr√©ation du graphique
            if (charts.categories) {
                charts.categories.destroy();
            }
            
            charts.categories = new Chart(categoriesCtx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors,
                        borderWidth: 1,
                        borderColor: '#ffffff',
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} produits (${percentage}%)`;
                                }
                            },
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#1e293b',
                            bodyColor: '#475569',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            cornerRadius: 8,
                            padding: 12
                        }
                    },
                    cutout: '55%', // R√©duit pour plus de surface
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000
                    }
                }
            });
            
            // Mettre √† jour la l√©gende
            updateCategoriesLegend(labels, backgroundColors, data, total);
        }

        function updateCategoriesLegend(labels, colors, data, total) {
            const legendContainer = document.getElementById('categoriesLegend');
            if (!legendContainer) return;
            
            let legendHTML = '';
            labels.forEach((label, index) => {
                const percentage = ((data[index] / total) * 100).toFixed(1);
                legendHTML += `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${colors[index]}"></div>
                        <span class="fw-medium">${label}</span>
                        <span class="text-muted ms-auto">${data[index]} (${percentage}%)</span>
                    </div>
                `;
            });
            
            legendContainer.innerHTML = legendHTML;
        }

        function refreshCategoriesChart() {
            // Simuler un refresh avec nouvelles donn√©es
            showToast('Graphique des cat√©gories actualis√©', 'info');
            
            // Animation de rotation
            const canvas = document.getElementById('categoriesChart');
            canvas.style.transform = 'rotate(180deg)';
            setTimeout(() => {
                canvas.style.transform = 'rotate(0deg)';
                canvas.style.transition = 'transform 0.5s ease';
            }, 100);
            
            // R√©initialiser le graphique
            initCategoriesChart();
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-body d-flex align-items-center">
                    <i class="bi ${getToastIcon(type)} me-3 fs-5"></i>
                    <div class="flex-grow-1">${message}</div>
                    <button type="button" class="btn-close ms-3" onclick="removeToast('${toastId}')"></button>
                </div>
            `;
            toast.id = toastId;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                removeToast(toastId);
            }, 5000);
        }

        function getToastIcon(type) {
            const icons = {
                'success': 'bi-check-circle-fill',
                'error': 'bi-x-circle-fill',
                'warning': 'bi-exclamation-triangle-fill',
                'info': 'bi-info-circle-fill'
            };
            return icons[type] || 'bi-info-circle-fill';
        }

        function removeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        }

        // ============================================
        // FONCTIONS DU DASHBOARD
        // ============================================
        function loadRecentOrders() {
            const table = document.getElementById('recentOrdersTable');
            if (!table) return;
            
            const sortedOrders = [...realOrders].sort((a, b) => {
                const dateA = new Date(a.date || a.timestamp || 0);
                const dateB = new Date(b.date || b.timestamp || 0);
                return dateB - dateA;
            });
            
            const recentOrders = sortedOrders.slice(0, 5);
            
            if (recentOrders.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4">
                            <i class="bi bi-cart display-4 text-muted mb-3"></i>
                            <h5>Aucune commande</h5>
                            <p class="text-muted">Les commandes pass√©es depuis la boutique appara√Ætront ici</p>
                            <a href="marques.html" class="btn btn-primary mt-2" target="_blank">
                                <i class="bi bi-eye me-2"></i>Voir la boutique
                            </a>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = recentOrders.map(order => `
                <tr>
                    <td>
                        <strong>${order.id || 'N/A'}</strong><br>
                        <small class="text-muted">${getDateFromTimestamp(order.date || order.timestamp)}</small>
                    </td>
                    <td>
                        <div><strong>${order.clientName || 'N/A'}</strong></div>
                        <small class="text-muted">${order.clientEmail || ''}</small>
                    </td>
                    <td>${formatDate(order.date || order.timestamp)}</td>
                    <td><strong>${formatNumber(order.total || 0)} F</strong></td>
                    <td>
                        <select class="form-select form-select-sm status-select" 
                                data-order-id="${order.id}" 
                                style="min-width: 120px;"
                                onchange="updateOrderStatus('${order.id}', this.value)">
                            <option value="new" ${order.status === 'new' ? 'selected' : ''}>Nouvelle</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>En traitement</option>
                            <option value="paid" ${order.status === 'paid' ? 'selected' : ''}>Pay√©e</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Livr√©e</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Annul√©e</option>
                        </select>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewOrder('${order.id}')" title="Voir">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-invoice" onclick="generateInvoice('${order.id}')" title="Facture">
                                <i class="bi bi-receipt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function viewOrder(orderId) {
            const order = realOrders.find(o => o.id === orderId);
            
            if (!order) {
                showToast('Commande non trouv√©e', 'error');
                return;
            }
            
            alert(`D√©tails de la commande #${orderId}\n\nClient: ${order.clientName}\nMontant: ${formatNumber(order.total || 0)} F\nStatut: ${getStatusText(order.status || 'new')}`);
        }

        // ============================================
        // FONCTIONS DE FACTURATION
        // ============================================

        function generateInvoice(orderId) {
            const order = realOrders.find(o => o.id === orderId);
            
            if (!order) {
                showToast('Commande non trouv√©e', 'error');
                return;
            }
            
            currentInvoiceData = order;
            
            // Extraire les produits de la commande
            const orderProducts = order.products || [{
                name: order.productName || 'Lunettes SenVision',
                quantity: order.quantity || 1,
                price: order.unitPrice || order.total || 0
            }];
            
            // Calculer le total
            const subtotal = orderProducts.reduce((sum, product) => 
                sum + (product.price * (product.quantity || 1)), 0);
            
            // Construire le contenu HTML de la facture
            const invoiceHTML = `
                <style>
                    .invoice-container {
                        font-family: 'Arial', sans-serif;
                        color: #333;
                    }
                    .invoice-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        margin-bottom: 40px;
                        border-bottom: 2px solid #4361ee;
                        padding-bottom: 20px;
                    }
                    .company-info {
                        flex: 1;
                    }
                    .invoice-title {
                        text-align: right;
                    }
                    .company-logo {
                        font-size: 24px;
                        font-weight: bold;
                        color: #4361ee;
                        margin-bottom: 10px;
                    }
                    .invoice-details {
                        margin: 30px 0;
                        display: flex;
                        justify-content: space-between;
                    }
                    .client-info, .invoice-info {
                        width: 45%;
                    }
                    .section-title {
                        font-size: 16px;
                        font-weight: bold;
                        color: #4361ee;
                        margin-bottom: 10px;
                        padding-bottom: 5px;
                        border-bottom: 1px solid #eee;
                    }
                    .invoice-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin: 20px 0;
                    }
                    .invoice-table th {
                        background: #f8f9fa;
                        padding: 12px;
                        text-align: left;
                        border-bottom: 2px solid #dee2e6;
                        font-weight: bold;
                        color: #495057;
                    }
                    .invoice-table td {
                        padding: 12px;
                        border-bottom: 1px solid #dee2e6;
                    }
                    .invoice-table tr:last-child td {
                        border-bottom: 2px solid #dee2e6;
                    }
                    .text-right {
                        text-align: right;
                    }
                    .totals-section {
                        margin-top: 30px;
                        width: 300px;
                        margin-left: auto;
                    }
                    .total-row {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 10px;
                        padding: 5px 0;
                    }
                    .grand-total {
                        font-size: 18px;
                        font-weight: bold;
                        color: #4361ee;
                        border-top: 2px solid #4361ee;
                        padding-top: 10px;
                        margin-top: 10px;
                    }
                    .footer {
                        margin-top: 50px;
                        padding-top: 20px;
                        border-top: 1px solid #dee2e6;
                        font-size: 12px;
                        color: #6c757d;
                        text-align: center;
                    }
                    .terms {
                        margin-top: 30px;
                        font-size: 12px;
                        color: #6c757d;
                    }
                    .stamp {
                        text-align: center;
                        margin-top: 30px;
                        padding: 20px;
                        border: 2px dashed #4361ee;
                        display: inline-block;
                        font-style: italic;
                        color: #4361ee;
                    }
                </style>
                
                <div class="invoice-container">
                    <div class="invoice-header">
                        <div class="company-info">
                            <div class="company-logo">
                                <i class="bi bi-eyeglasses"></i> SenVision Optique
                            </div>
                            <div>
                                <strong>SenVision Optique S√©n√©gal</strong><br>
                                Dakar, S√©n√©gal<br>
                                T√©l√©phone: +221 33 123 45 67<br>
                                Email: contact@senvision.sn<br>
                                NIF: 1234567890
                            </div>
                        </div>
                        <div class="invoice-title">
                            <h1 style="color: #4361ee; margin: 0;">FACTURE</h1>
                            <div style="font-size: 14px; margin-top: 10px;">
                                Num√©ro: <strong>${order.id}</strong><br>
                                Date: <strong>${formatDate(order.date || order.timestamp)}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="invoice-details">
                        <div class="client-info">
                            <div class="section-title">CLIENT</div>
                            <div>
                                <strong>${order.clientName || 'Non sp√©cifi√©'}</strong><br>
                                ${order.clientEmail ? order.clientEmail + '<br>' : ''}
                                ${order.clientPhone || ''}<br>
                                ${order.clientAddress || ''}
                            </div>
                        </div>
                        
                        <div class="invoice-info">
                            <div class="section-title">D√âTAILS DE LA FACTURE</div>
                            <div>
                                <strong>R√©f√©rence:</strong> ${order.id}<br>
                                <strong>Date:</strong> ${formatDate(order.date || order.timestamp)}<br>
                                <strong>Statut:</strong> ${getStatusText(order.status)}<br>
                                <strong>Mode de paiement:</strong> ${getPaymentMethodText(order.paymentMethod)}
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-title">ARTICLES</div>
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th width="50">#</th>
                                <th>Description</th>
                                <th width="100" class="text-right">Prix unitaire</th>
                                <th width="80" class="text-right">Quantit√©</th>
                                <th width="120" class="text-right">Montant</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orderProducts.map((product, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${product.name}</td>
                                    <td class="text-right">${formatNumber(product.price)} F</td>
                                    <td class="text-right">${product.quantity || 1}</td>
                                    <td class="text-right">${formatNumber(product.price * (product.quantity || 1))} F</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="totals-section">
                        <div class="total-row">
                            <span>Sous-total:</span>
                            <span>${formatNumber(subtotal)} F</span>
                        </div>
                        <div class="total-row">
                            <span>Livraison:</span>
                            <span>${order.shippingCost ? formatNumber(order.shippingCost) + ' F' : '0 F'}</span>
                        </div>
                        <div class="total-row">
                            <span>Remise:</span>
                            <span>${order.discount ? '-' + formatNumber(order.discount) + ' F' : '0 F'}</span>
                        </div>
                        <div class="total-row grand-total">
                            <span>TOTAL:</span>
                            <span>${formatNumber(order.total || subtotal)} F</span>
                        </div>
                    </div>
                    
                    <div class="terms">
                        <div class="section-title">CONDITIONS DE PAIEMENT</div>
                        <p>
                            Paiement √† r√©ception de la facture.<br>
                            Paiement par Mobile Money, virement bancaire ou esp√®ces.<br>
                            Taux de change: XOF (Franc CFA)
                        </p>
                    </div>
                    
                    <div class="stamp">
                        PAY√â<br>
                        ${new Date().toLocaleDateString('fr-FR')}
                    </div>
                    
                    <div class="footer">
                        <p>
                            Merci pour votre confiance !<br>
                            SenVision Optique - Votre vision, notre passion<br>
                            T√©l: +221 33 123 45 67 | Email: contact@senvision.sn<br>
                            <small>Cette facture est g√©n√©r√©e automatiquement par le syst√®me SenVision</small>
                        </p>
                    </div>
                </div>
            `;
            
            // Injecter le HTML dans le modal
            document.getElementById('invoiceContent').innerHTML = invoiceHTML;
            document.getElementById('invoiceNumber').textContent = order.id;
            
            // Afficher le modal
            const modal = new bootstrap.Modal(document.getElementById('invoiceModal'));
            modal.show();
        }

        function downloadInvoicePDF() {
            if (!currentInvoiceData) {
                showToast('Aucune facture √† t√©l√©charger', 'error');
                return;
            }
            
            showToast('G√©n√©ration du PDF en cours...', 'info');
            
            const invoiceElement = document.getElementById('invoiceContent');
            
            html2canvas(invoiceElement, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                
                const fileName = `facture-senvision-${currentInvoiceData.id}-${Date.now()}.pdf`;
                pdf.save(fileName);
                
                showToast('Facture t√©l√©charg√©e avec succ√®s', 'success');
            }).catch(error => {
                console.error('Erreur lors de la g√©n√©ration du PDF:', error);
                showToast('Erreur lors de la g√©n√©ration du PDF', 'error');
            });
        }

        function printInvoice() {
            if (!currentInvoiceData) {
                showToast('Aucune facture √† imprimer', 'error');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Facture SenVision - ${currentInvoiceData.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            @media print {
                                @page { margin: 0; }
                                body { margin: 1.6cm; }
                            }
                        </style>
                    </head>
                    <body>
                        ${document.getElementById('invoiceContent').innerHTML}
                    </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }

        function showAddProductModal() {
            const modal = new bootstrap.Modal(document.getElementById('addProductModal'));
            modal.show();
        }

        function saveProduct() {
            const form = document.getElementById('productForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const newProduct = {
                id: 'PROD-' + Date.now(),
                nom: document.getElementById('productName').value,
                name: document.getElementById('productName').value,
                sku: document.getElementById('productSKU').value,
                categorie: document.getElementById('productCategory').value,
                category: document.getElementById('productCategory').value,
                brand: document.getElementById('productBrand').value,
                marque: document.getElementById('productBrand').value,
                price: parseInt(document.getElementById('productPrice').value),
                prix: parseInt(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                description: document.getElementById('productDescription').value,
                description_courte: document.getElementById('productDescription').value,
                image: document.getElementById('productImage').value || 'https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400&h=300&fit=crop',
                date_creation: new Date().toISOString(),
                nouveau: true,
                bestseller: Math.random() > 0.7
            };
            
            realProducts.push(newProduct);
            localStorage.setItem('senvision-products', JSON.stringify(realProducts));
            
            showToast('Produit ajout√© avec succ√®s', 'success');
            const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
            modal.hide();
            
            form.reset();
            loadProductsGrid();
            updateStats();
            initCategoriesChart();
        }

        // ============================================
        // FONCTIONS DES SECTIONS
        // ============================================
        function loadOrdersTable() {
            const table = document.getElementById('ordersTable');
            if (!table) return;
            
            if (realOrders.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="bi bi-cart display-4 text-muted mb-3"></i>
                            <h5>Aucune commande</h5>
                            <p class="text-muted">Les commandes pass√©es depuis la boutique appara√Ætront ici</p>
                            <a href="marques.html" class="btn btn-primary mt-2" target="_blank">
                                <i class="bi bi-eye me-2"></i>Voir la boutique
                            </a>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const sortedOrders = [...realOrders].sort((a, b) => {
                const dateA = new Date(a.date || a.timestamp || 0);
                const dateB = new Date(b.date || b.timestamp || 0);
                return dateB - dateA;
            });
            
            table.innerHTML = sortedOrders.map(order => `
                <tr>
                    <td>
                        <strong>${order.id || 'N/A'}</strong>
                    </td>
                    <td>
                        <div><strong>${order.clientName || 'N/A'}</strong></div>
                        <small class="text-muted">${order.clientEmail || ''}</small>
                    </td>
                    <td>${order.clientPhone || 'N/A'}</td>
                    <td>${formatDate(order.date || order.timestamp)}</td>
                    <td><strong>${formatNumber(order.total || 0)} F</strong></td>
                    <td>
                        <select class="form-select form-select-sm status-select" 
                                data-order-id="${order.id}" 
                                style="min-width: 150px;"
                                onchange="updateOrderStatus('${order.id}', this.value)">
                            <option value="new" ${order.status === 'new' ? 'selected' : ''}>Nouvelle</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>En traitement</option>
                            <option value="paid" ${order.status === 'paid' ? 'selected' : ''}>Pay√©e</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Livr√©e</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Annul√©e</option>
                        </select>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewOrder('${order.id}')" title="Voir">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-invoice" onclick="generateInvoice('${order.id}')" title="Facture">
                                <i class="bi bi-receipt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Fonction pour mettre √† jour le statut d'une commande
        function updateOrderStatus(orderId, newStatus) {
            const orderIndex = realOrders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) {
                showToast('Commande non trouv√©e', 'error');
                return;
            }
            
            const oldStatus = realOrders[orderIndex].status;
            realOrders[orderIndex].status = newStatus;
            realOrders[orderIndex].updatedAt = new Date().toISOString();
            
            // Sauvegarder dans localStorage
            localStorage.setItem('senvision-orders', JSON.stringify(realOrders));
            
            // Mettre √† jour le statut dans le tableau de bord
            const statusElement = document.querySelector(`[data-order-id="${orderId}"]`);
            if (statusElement) {
                statusElement.value = newStatus;
            }
            
            showToast(`Statut de la commande #${orderId} mis √† jour : ${getStatusText(oldStatus)} ‚Üí ${getStatusText(newStatus)}`, 'success');
            
            // Si le statut est "paid", cr√©er une transaction comptable automatiquement
            if (newStatus === 'paid') {
                createTransactionFromOrder(realOrders[orderIndex]);
            }
            
            // Mettre √† jour les statistiques
            updateStats();
            loadRecentOrders();
        }

        // Fonction pour cr√©er une transaction comptable √† partir d'une commande pay√©e
        function createTransactionFromOrder(order) {
            // V√©rifier si une transaction existe d√©j√† pour cette commande
            const existingTransaction = accounts.find(acc => 
                acc.reference === order.id && acc.type === 'income');
            
            if (existingTransaction) {
                return; // Transaction d√©j√† existante
            }
            
            const newTransaction = {
                id: 'TXN-' + Date.now(),
                type: 'income',
                category: 'sales',
                date: new Date().toISOString().split('T')[0],
                amount: order.total || 0,
                paymentMethod: order.paymentMethod || 'mobile_money',
                reference: order.id,
                description: `Vente commande #${order.id} - ${order.clientName}`,
                status: 'completed',
                customerId: order.clientPhone,
                customerName: order.clientName,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            accounts.push(newTransaction);
            localStorage.setItem('senvision-accounts', JSON.stringify(accounts));
            
            showToast('Transaction comptable cr√©√©e automatiquement', 'info');
        }

        // Fonction pour exporter en Excel
        function exportOrders(format) {
            if (realOrders.length === 0) {
                showToast('Aucune commande √† exporter', 'warning');
                return;
            }
            
            showToast(`G√©n√©ration du fichier ${format.toUpperCase()}...`, 'info');
            
            if (format === 'excel') {
                exportToExcel();
            } else if (format === 'pdf') {
                exportOrdersToPDF();
            }
        }

        // Fonction pour exporter en Excel
        function exportToExcel() {
            try {
                // Pr√©parer les donn√©es
                const headers = ['ID', 'Client', 'Email', 'T√©l√©phone', 'Date', 'Montant', 'Statut', 'M√©thode Paiement'];
                const data = realOrders.map(order => [
                    order.id || 'N/A',
                    order.clientName || 'N/A',
                    order.clientEmail || '',
                    order.clientPhone || '',
                    formatDate(order.date || order.timestamp),
                    `${order.total || 0} F`,
                    getStatusText(order.status || 'new'),
                    getPaymentMethodText(order.paymentMethod)
                ]);
                
                // Cr√©er le contenu CSV
                const csvContent = [
                    headers.join(','),
                    ...data.map(row => row.map(cell => `"${cell}"`).join(','))
                ].join('\n');
                
                // Cr√©er le fichier Blob
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                // Cr√©er le nom de fichier
                const date = new Date();
                const fileName = `commandes_senvision_${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}.csv`;
                
                // T√©l√©charger le fichier
                if (navigator.msSaveBlob) { // Pour IE
                    navigator.msSaveBlob(blob, fileName);
                } else {
                    link.href = URL.createObjectURL(blob);
                    link.setAttribute('download', fileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                
                showToast('Export Excel termin√© avec succ√®s', 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'export Excel:', error);
                showToast('Erreur lors de l\'export Excel', 'error');
            }
        }

        // Fonction pour exporter en PDF
        function exportOrdersToPDF() {
            if (realOrders.length === 0) {
                showToast('Aucune commande √† exporter', 'warning');
                return;
            }
            
            showToast('G√©n√©ration du rapport PDF...', 'info');
            
            try {
                // Cr√©er un nouvel objet jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Titre du document
                doc.setFontSize(20);
                doc.setTextColor(67, 97, 238); // Couleur primaire
                doc.text('Rapport des Commandes - SenVision Optique', 20, 20);
                
                // Informations de g√©n√©ration
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`G√©n√©r√© le: ${new Date().toLocaleDateString('fr-FR')}`, 20, 30);
                doc.text(`Total commandes: ${realOrders.length}`, 20, 35);
                
                // Calcul des statistiques
                const totalRevenue = realOrders.reduce((sum, order) => sum + (order.total || 0), 0);
                const paidOrders = realOrders.filter(order => order.status === 'paid').length;
                const pendingOrders = realOrders.filter(order => order.status === 'new' || order.status === 'processing').length;
                
                doc.text(`Chiffre d'affaires total: ${formatNumber(totalRevenue)} FCFA`, 20, 40);
                doc.text(`Commandes pay√©es: ${paidOrders}`, 20, 45);
                doc.text(`Commandes en attente: ${pendingOrders}`, 20, 50);
                
                // Tableau des commandes
                doc.autoTable({
                    startY: 60,
                    head: [['ID', 'Client', 'Date', 'Montant', 'Statut', 'Paiement']],
                    body: realOrders.map(order => [
                        order.id || 'N/A',
                        (order.clientName || 'N/A').substring(0, 20),
                        new Date(order.date || order.timestamp).toLocaleDateString('fr-FR'),
                        `${formatNumber(order.total || 0)} F`,
                        getStatusText(order.status || 'new'),
                        getPaymentMethodText(order.paymentMethod).substring(0, 15)
                    ]),
                    theme: 'striped',
                    headStyles: {
                        fillColor: [67, 97, 238], // Couleur primaire
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    margin: { top: 60 },
                    didDrawPage: function(data) {
                        // Pied de page
                        doc.setFontSize(8);
                        doc.setTextColor(128, 128, 128);
                        doc.text('SenVision Optique - Rapport g√©n√©r√© automatiquement', 
                            data.settings.margin.left, 
                            doc.internal.pageSize.height - 10);
                        doc.text(`Page ${data.pageNumber}`, 
                            doc.internal.pageSize.width - 20, 
                            doc.internal.pageSize.height - 10, 
                            { align: 'right' });
                    }
                });
                
                // Sauvegarder le PDF
                const fileName = `rapport_commandes_senvision_${Date.now()}.pdf`;
                doc.save(fileName);
                
                showToast('Rapport PDF g√©n√©r√© avec succ√®s', 'success');
                
            } catch (error) {
                console.error('Erreur lors de la g√©n√©ration PDF:', error);
                showToast('Erreur lors de la g√©n√©ration du PDF', 'error');
            }
        }

        // Fonction pour g√©n√©rer le rapport complet des commandes
        function generateOrdersReport() {
            exportOrdersToPDF();
        }

        // Fonction de filtrage des commandes
        function filterOrders() {
            const statusFilter = document.getElementById('orderStatusFilter').value;
            const dateFilter = document.getElementById('orderDateFilter').value;
            
            let filteredOrders = [...realOrders];
            
            // Filtrer par statut
            if (statusFilter) {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }
            
            // Filtrer par date
            if (dateFilter) {
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.date || order.timestamp).toISOString().split('T')[0];
                    return orderDate === dateFilter;
                });
            }
            
            // Afficher les r√©sultats filtr√©s
            displayFilteredOrders(filteredOrders);
            
            showToast(`${filteredOrders.length} commande(s) trouv√©e(s)`, 'info');
        }

        function displayFilteredOrders(filteredOrders) {
            const table = document.getElementById('ordersTable');
            if (!table) return;
            
            if (filteredOrders.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="bi bi-search display-4 text-muted mb-3"></i>
                            <h5>Aucune commande correspondante</h5>
                            <button class="btn btn-outline-primary mt-2" onclick="resetFilters()">
                                <i class="bi bi-arrow-counterclockwise me-2"></i>R√©initialiser les filtres
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = filteredOrders.map(order => `
                <tr>
                    <td>
                        <strong>${order.id || 'N/A'}</strong>
                    </td>
                    <td>
                        <div><strong>${order.clientName || 'N/A'}</strong></div>
                        <small class="text-muted">${order.clientEmail || ''}</small>
                    </td>
                    <td>${order.clientPhone || 'N/A'}</td>
                    <td>${formatDate(order.date || order.timestamp)}</td>
                    <td><strong>${formatNumber(order.total || 0)} F</strong></td>
                    <td>
                        <select class="form-select form-select-sm status-select" 
                                data-order-id="${order.id}" 
                                style="min-width: 150px;"
                                onchange="updateOrderStatus('${order.id}', this.value)">
                            <option value="new" ${order.status === 'new' ? 'selected' : ''}>Nouvelle</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>En traitement</option>
                            <option value="paid" ${order.status === 'paid' ? 'selected' : ''}>Pay√©e</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Livr√©e</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Annul√©e</option>
                        </select>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewOrder('${order.id}')" title="Voir">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-invoice" onclick="generateInvoice('${order.id}')" title="Facture">
                                <i class="bi bi-receipt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function resetFilters() {
            document.getElementById('orderStatusFilter').value = '';
            document.getElementById('orderDateFilter').value = '';
            loadOrdersTable();
            showToast('Filtres r√©initialis√©s', 'info');
        }

        function loadProductsGrid() {
            const grid = document.getElementById('productsGrid');
            if (!grid) return;
            
            if (realProducts.length === 0) {
                grid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-box display-4 text-muted mb-3"></i>
                        <h5>Aucun produit</h5>
                        <p class="text-muted">Les produits ajout√©s appara√Ætront ici</p>
                        <button class="btn btn-primary mt-2" onclick="showAddProductModal()">
                            <i class="bi bi-plus-circle me-2"></i>Ajouter un produit
                        </button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = realProducts.map(product => `
                <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
                    <div class="product-card">
                        <div class="product-image" onclick="viewProductImage('${product.id}')">
                            <img src="${product.image || 'https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400&h=300&fit=crop'}" 
                                 alt="${product.nom || product.name}" 
                                 onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"300\" viewBox=\"0 0 400 300\"><rect width=\"400\" height=\"300\" fill=\"%23f5f7fa\"/><text x=\"200\" y=\"150\" font-family=\"Arial\" font-size=\"20\" text-anchor=\"middle\" dy=\".3em\" fill=\"%23666\">${(product.nom || product.name).substring(0, 20)}</text></svg>'">
                            ${product.nouveau || product.bestseller ? 
                                '<span class="product-badge">' + (product.nouveau ? 'Nouveau' : 'Best-seller') + '</span>' : ''}
                            
                            <!-- Boutons d'action sur l'image -->
                            <div class="product-actions">
                                <button class="btn-image-action" onclick="viewProductImage('${product.id}')" title="Agrandir">
                                    <i class="bi bi-zoom-in"></i>
                                </button>
                                <button class="btn-image-action" onclick="shareProduct('${product.id}')" title="Partager">
                                    <i class="bi bi-share"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="product-info">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h5 class="mb-1">${product.nom || product.name}</h5>
                                    <small class="text-muted">${product.categorie || 'Non cat√©goris√©'} ‚Ä¢ ${product.marque || product.brand || 'Non sp√©cifi√©'}</small>
                                </div>
                                <div class="product-price">
                                    ${formatNumber(product.prix || product.price || 0)} F
                                </div>
                            </div>
                            
                            <p class="text-muted small mb-3">${product.description_courte || product.description || 'Pas de description'}</p>
                            
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="stock-indicator ${getStockClass(product.stock || 0, 5)}">
                                        <i class="bi ${getStockIcon(product.stock || 0, 5)}"></i>
                                        Stock: ${product.stock || 0}
                                    </span>
                                </div>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-primary" 
                                            onclick="editRealProduct('${product.id}')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" 
                                            onclick="deleteRealProduct('${product.id}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStockClass(stock, minStock) {
            if (stock <= minStock) return 'stock-low';
            if (stock <= minStock * 2) return 'stock-medium';
            return 'stock-high';
        }

        function getStockIcon(stock, minStock) {
            if (stock <= minStock) return 'bi-exclamation-triangle';
            if (stock <= minStock * 2) return 'bi-exclamation-circle';
            return 'bi-check-circle';
        }

        // ============================================
        // FONCTIONS POUR LES IMAGES PRODUITS
        // ============================================
        function viewProductImage(productId) {
            const product = realProducts.find(p => p.id === productId);
            if (!product) return;
            
            const imageUrl = product.image || 'https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=800&h=600&fit=crop';
            
            // Cr√©er un modal pour afficher l'image en grand
            const modalHTML = `
                <div class="modal fade product-image-modal" id="productImageModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header border-0">
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body text-center">
                                <img src="${imageUrl}" 
                                     alt="${product.nom || product.name}"
                                     class="img-fluid"
                                     onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"800\" height=\"600\" viewBox=\"0 0 800 600\"><rect width=\"800\" height=\"600\" fill=\"%23f5f7fa\"/><text x=\"400\" y=\"300\" font-family=\"Arial\" font-size=\"24\" text-anchor=\"middle\" dy=\".3em\" fill=\"%23666\">${(product.nom || product.name).substring(0, 40)}</text></svg>'">
                                <div class="mt-3">
                                    <h5>${product.nom || product.name}</h5>
                                    <p class="text-muted">${product.marque || product.brand || ''} ‚Ä¢ ${product.categorie || ''}</p>
                                </div>
                            </div>
                            <div class="modal-footer border-0 justify-content-center">
                                <button type="button" class="btn btn-primary" onclick="downloadProductImage('${productId}')">
                                    <i class="bi bi-download me-2"></i>T√©l√©charger
                                </button>
                                <button type="button" class="btn btn-outline-primary" onclick="shareProduct('${productId}')">
                                    <i class="bi bi-share me-2"></i>Partager
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Ajouter le modal au DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Afficher le modal
            const modal = new bootstrap.Modal(document.getElementById('productImageModal'));
            modal.show();
            
            // Nettoyer apr√®s fermeture
            document.getElementById('productImageModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        function downloadProductImage(productId) {
            const product = realProducts.find(p => p.id === productId);
            if (!product) return;
            
            const imageUrl = product.image || 'https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=800&h=600&fit=crop';
            const fileName = `senvision-${(product.nom || product.name).replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.jpg`;
            
            fetch(imageUrl)
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    showToast('Image t√©l√©charg√©e avec succ√®s', 'success');
                })
                .catch(error => {
                    console.error('Erreur lors du t√©l√©chargement:', error);
                    showToast('Erreur lors du t√©l√©chargement', 'error');
                });
        }

        function shareProduct(productId) {
            const product = realProducts.find(p => p.id === productId);
            if (!product) return;
            
            const shareData = {
                title: product.nom || product.name,
                text: `D√©couvrez ${product.nom || product.name} sur SenVision Optique`,
                url: window.location.origin
            };
            
            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => showToast('Produit partag√© avec succ√®s', 'success'))
                    .catch(error => console.log('Erreur de partage:', error));
            } else {
                // Fallback pour les navigateurs qui ne supportent pas l'API Web Share
                navigator.clipboard.writeText(`${shareData.text}: ${shareData.url}`)
                    .then(() => showToast('Lien copi√© dans le presse-papier', 'success'))
                    .catch(() => {
                        const textArea = document.createElement('textarea');
                        textArea.value = `${shareData.text}: ${shareData.url}`;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showToast('Lien copi√© dans le presse-papier', 'success');
                    });
            }
        }

        function editRealProduct(productId) {
            const product = realProducts.find(p => p.id === productId);
            if (!product) return;
            
            showAddProductModal();
            
            setTimeout(() => {
                document.getElementById('productName').value = product.nom || product.name;
                document.getElementById('productSKU').value = product.sku || '';
                document.getElementById('productCategory').value = product.categorie || product.category || '';
                document.getElementById('productBrand').value = product.brand || product.marque || '';
                document.getElementById('productPrice').value = product.price || product.prix || 0;
                document.getElementById('productStock').value = product.stock || 0;
                document.getElementById('productImage').value = product.image || '';
                document.getElementById('productDescription').value = product.description || product.description_courte || '';
                
                showToast('Modification du produit ' + productId, 'info');
            }, 500);
        }

        function deleteRealProduct(productId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce produit ?')) {
                realProducts = realProducts.filter(p => p.id !== productId);
                localStorage.setItem('senvision-products', JSON.stringify(realProducts));
                loadProductsGrid();
                updateStats();
                initCategoriesChart();
                showToast('Produit supprim√© avec succ√®s', 'success');
            }
        }

        function loadCustomersTable() {
            const table = document.getElementById('customersTable');
            if (!table) return;
            
            if (realCustomers.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-5">
                            <i class="bi bi-people display-4 text-muted mb-3"></i>
                            <h5>Aucun client</h5>
                            <p class="text-muted">Les clients appara√Ætront apr√®s leur premi√®re commande</p>
                            <a href="marques.html" class="btn btn-primary mt-2" target="_blank">
                                <i class="bi bi-eye me-2"></i>Voir la boutique
                            </a>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = realCustomers.map((customer, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <div><strong>${customer.name}</strong></div>
                        <small class="text-muted">Premi√®re commande: ${formatDate(customer.firstOrder)}</small>
                    </td>
                    <td>${customer.email || 'N/A'}</td>
                    <td>${customer.phone}</td>
                    <td>
                        <span class="badge bg-primary rounded-pill">${customer.totalOrders}</span>
                    </td>
                    <td><strong>${formatNumber(customer.totalSpent)} F</strong></td>
                    <td>
                        <span class="badge ${getCustomerType(customer.totalSpent)}">
                            ${getCustomerTypeText(customer.totalSpent)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-2" 
                                onclick="viewCustomerDetails('${customer.phone}')">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success" 
                                onclick="sendEmailToCustomer('${customer.email}')">
                            <i class="bi bi-envelope"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getCustomerType(totalSpent) {
            if (totalSpent > 500000) return 'bg-danger';
            if (totalSpent > 200000) return 'bg-warning';
            if (totalSpent > 50000) return 'bg-info';
            return 'bg-secondary';
        }

        function getCustomerTypeText(totalSpent) {
            if (totalSpent > 500000) return 'VIP';
            if (totalSpent > 200000) return 'Premium';
            if (totalSpent > 50000) return 'R√©gulier';
            return 'Nouveau';
        }

        function viewCustomerDetails(phone) {
            const customer = realCustomers.find(c => c.phone === phone);
            if (!customer) return;
            
            const customerOrders = realOrders.filter(o => o.clientPhone === phone);
            
            let alertMessage = `Client: ${customer.name}\n`;
            alertMessage += `T√©l√©phone: ${customer.phone}\n`;
            alertMessage += `Email: ${customer.email || 'N/A'}\n`;
            alertMessage += `Total commandes: ${customer.totalOrders}\n`;
            alertMessage += `Total d√©pens√©: ${formatNumber(customer.totalSpent)} F\n\n`;
            alertMessage += `Derni√®res commandes:\n`;
            
            customerOrders.slice(0, 3).forEach(order => {
                alertMessage += `- ${order.id}: ${formatNumber(order.total || 0)} F (${getStatusText(order.status || 'new')})\n`;
            });
            
            alert(alertMessage);
        }

        function sendEmailToCustomer(email) {
            if (!email || email === 'N/A') {
                showToast('Email non disponible', 'warning');
                return;
            }
            
            window.open(`mailto:${email}`, '_blank');
        }

        // ============================================
        // GESTION DES COMPTES
        // ============================================
        function loadAccountsData() {
            accounts = JSON.parse(localStorage.getItem('senvision-accounts')) || [];
            suppliers = JSON.parse(localStorage.getItem('senvision-suppliers')) || [];
            
            updateAccountsStats();
            loadAccountsTable();
        }

        function updateAccountsStats() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const totalRevenue = accounts
                .filter(acc => acc.type === 'income' && acc.status === 'completed')
                .reduce((sum, acc) => sum + (acc.amount || 0), 0);
            
            const totalExpenses = accounts
                .filter(acc => acc.type === 'expense' && acc.status === 'completed')
                .reduce((sum, acc) => sum + (acc.amount || 0), 0);
            
            const currentBalance = totalRevenue - totalExpenses;
            
            const monthlyTransactions = accounts
                .filter(acc => {
                    const accDate = new Date(acc.date);
                    return accDate.getMonth() === currentMonth && 
                           accDate.getFullYear() === currentYear;
                })
                .length;
            
            document.getElementById('totalRevenue').textContent = formatNumber(totalRevenue) + ' F';
            document.getElementById('totalExpenses').textContent = formatNumber(totalExpenses) + ' F';
            document.getElementById('currentBalance').textContent = formatNumber(currentBalance) + ' F';
            document.getElementById('monthlyTransactions').textContent = monthlyTransactions;
            
            const balanceElement = document.getElementById('currentBalance');
            if (currentBalance < 0) {
                balanceElement.classList.remove('text-primary');
                balanceElement.classList.add('text-danger');
            } else {
                balanceElement.classList.remove('text-danger');
                balanceElement.classList.add('text-primary');
            }
        }

        function loadAccountsTable() {
            const table = document.getElementById('accountsTable');
            if (!table) return;
            
            if (accounts.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center py-5">
                            <i class="bi bi-cash-stack display-4 text-muted mb-3"></i>
                            <h5>Aucune transaction</h5>
                            <p class="text-muted">Commencez par ajouter vos premi√®res transactions</p>
                            <button class="btn btn-primary mt-2" onclick="showAddAccountModal()">
                                <i class="bi bi-plus-circle me-2"></i>Ajouter une transaction
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const sortedAccounts = [...accounts].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            table.innerHTML = sortedAccounts.map(account => `
                <tr>
                    <td>${formatDate(account.date)}</td>
                    <td>
                        <strong>${account.reference || 'N/A'}</strong>
                        <br>
                        <small class="text-muted">${account.id.substring(0, 8)}</small>
                    </td>
                    <td>
                        <div class="fw-medium">${account.description.substring(0, 50)}${account.description.length > 50 ? '...' : ''}</div>
                        ${account.customerName ? `<small class="text-muted">Client: ${account.customerName}</small>` : ''}
                    </td>
                    <td>
                        <span class="badge ${getAccountCategoryBadge(account.category)}">
                            ${getAccountCategoryText(account.category)}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${account.type === 'income' ? 'bg-success' : 'bg-danger'}">
                            ${account.type === 'income' ? 'Recette' : 'D√©pense'}
                        </span>
                    </td>
                    <td>
                        <strong class="${account.type === 'income' ? 'text-success' : 'text-danger'}">
                            ${account.type === 'income' ? '+' : '-'}${formatNumber(account.amount)} F
                        </strong>
                    </td>
                    <td>
                        <span class="badge bg-secondary">
                            ${getPaymentMethodText(account.paymentMethod)}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge status-${account.status || 'completed'}">
                            ${getAccountStatusText(account.status)}
                        </span>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-info" onclick="viewTransactionDetails('${account.id}')" title="Voir d√©tails">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-outline-warning" onclick="editTransaction('${account.id}')" title="Modifier">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteTransaction('${account.id}')" title="Supprimer">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getAccountCategoryBadge(category) {
            const badges = {
                'sales': 'bg-primary',
                'purchases': 'bg-warning',
                'salary': 'bg-info',
                'rent': 'bg-secondary',
                'utilities': 'bg-success',
                'marketing': 'bg-purple',
                'maintenance': 'bg-teal',
                'other': 'bg-dark'
            };
            return badges[category] || 'bg-secondary';
        }

        function getAccountCategoryText(category) {
            const categories = {
                'sales': 'Ventes',
                'purchases': 'Achats',
                'salary': 'Salaires',
                'rent': 'Loyer',
                'utilities': 'Services',
                'marketing': 'Marketing',
                'maintenance': 'Maintenance',
                'other': 'Autres'
            };
            return categories[category] || category;
        }

        function getAccountStatusText(status) {
            const statuses = {
                'pending': 'En attente',
                'completed': 'Compl√©t√©',
                'cancelled': 'Annul√©'
            };
            return statuses[status] || status;
        }

        function showAddAccountModal() {
            const modal = new bootstrap.Modal(document.getElementById('addAccountModal'));
            
            const customerSelect = document.getElementById('transactionCustomer');
            customerSelect.innerHTML = `
                <option value="">S√©lectionner un client</option>
                ${realCustomers.map(c => `<option value="${c.id}">${c.name} - ${c.phone}</option>`).join('')}
            `;
            
            modal.show();
        }

        function toggleTransactionFields() {
            const type = document.getElementById('transactionType').value;
            const customerField = document.getElementById('customerField');
            
            if (type === 'income') {
                customerField.style.display = 'block';
            } else {
                customerField.style.display = 'none';
            }
        }

        function saveTransaction() {
            const form = document.getElementById('accountForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const transactionType = document.getElementById('transactionType').value;
            const customerId = document.getElementById('transactionCustomer').value;
            const customer = realCustomers.find(c => c.id === customerId);
            
            const newTransaction = {
                id: 'TXN-' + Date.now(),
                type: transactionType,
                category: document.getElementById('transactionCategory').value,
                date: document.getElementById('transactionDate').value,
                amount: parseInt(document.getElementById('transactionAmount').value),
                paymentMethod: document.getElementById('transactionPaymentMethod').value,
                reference: document.getElementById('transactionReference').value || `TXN-${Date.now().toString().slice(-6)}`,
                description: document.getElementById('transactionDescription').value,
                status: document.getElementById('transactionStatus').value,
                customerId: customerId,
                customerName: customer ? customer.name : null,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            const attachmentInput = document.getElementById('transactionAttachment');
            if (attachmentInput.files.length > 0) {
                const file = attachmentInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    newTransaction.attachment = {
                        name: file.name,
                        type: file.type,
                        data: e.target.result
                    };
                    completeSaveTransaction(newTransaction);
                };
                reader.readAsDataURL(file);
            } else {
                completeSaveTransaction(newTransaction);
            }
        }

        function completeSaveTransaction(transaction) {
            accounts.push(transaction);
            localStorage.setItem('senvision-accounts', JSON.stringify(accounts));
            
            if (transaction.type === 'income' && transaction.category === 'sales' && transaction.customerId) {
                const customer = realCustomers.find(c => c.id === transaction.customerId);
                if (customer) {
                    customer.totalSpent += transaction.amount;
                    customer.totalOrders++;
                    localStorage.setItem('senvision-customers', JSON.stringify(realCustomers));
                }
            }
            
            showToast('Transaction enregistr√©e avec succ√®s', 'success');
            const modal = bootstrap.Modal.getInstance(document.getElementById('addAccountModal'));
            modal.hide();
            
            document.getElementById('accountForm').reset();
            document.getElementById('customerField').style.display = 'none';
            
            loadAccountsData();
        }

        function viewTransactionDetails(transactionId) {
            const transaction = accounts.find(t => t.id === transactionId);
            if (!transaction) {
                showToast('Transaction non trouv√©e', 'error');
                return;
            }
            
            alert(`D√©tails transaction #${transaction.reference}\n\nType: ${transaction.type === 'income' ? 'Recette' : 'D√©pense'}\nMontant: ${formatNumber(transaction.amount)} F\nDate: ${formatDate(transaction.date)}\nDescription: ${transaction.description}`);
        }

        function editTransaction(transactionId) {
            const transaction = accounts.find(t => t.id === transactionId);
            if (!transaction) {
                showToast('Transaction non trouv√©e', 'error');
                return;
            }
            
            showAddAccountModal();
            
            setTimeout(() => {
                document.getElementById('transactionType').value = transaction.type;
                document.getElementById('transactionCategory').value = transaction.category;
                document.getElementById('transactionDate').value = transaction.date.split('T')[0];
                document.getElementById('transactionAmount').value = transaction.amount;
                document.getElementById('transactionPaymentMethod').value = transaction.paymentMethod;
                document.getElementById('transactionReference').value = transaction.reference;
                document.getElementById('transactionDescription').value = transaction.description;
                document.getElementById('transactionStatus').value = transaction.status;
                
                if (transaction.customerId) {
                    document.getElementById('transactionCustomer').value = transaction.customerId;
                    toggleTransactionFields();
                }
                
                showToast('Modification de la transaction ' + transaction.reference, 'info');
            }, 500);
        }

        function deleteTransaction(transactionId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette transaction ? Cette action est irr√©versible.')) {
                accounts = accounts.filter(t => t.id !== transactionId);
                localStorage.setItem('senvision-accounts', JSON.stringify(accounts));
                
                loadAccountsData();
                showToast('Transaction supprim√©e avec succ√®s', 'success');
            }
        }

        // ============================================
        // FONCTIONS DES AUTRES SECTIONS
        // ============================================
        function loadMessagesList() {
            const container = document.getElementById('messagesList');
            if (!container) return;
            
            container.innerHTML = `
                <div class="text-center py-5">
                    <i class="bi bi-chat-text display-4 text-muted mb-3"></i>
                    <h5>Aucun message</h5>
                    <p class="text-muted">Les messages des clients appara√Ætront ici</p>
                </div>
            `;
        }

        function markAllAsRead() {
            showToast('Tous les messages marqu√©s comme lus', 'success');
        }

        function loadInventoryTable() {
            const table = document.getElementById('inventoryTable');
            if (!table) return;
            
            if (realProducts.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="bi bi-box-seam display-4 text-muted mb-3"></i>
                            <h5>Aucun produit en stock</h5>
                            <p class="text-muted">Ajoutez des produits pour g√©rer l'inventaire</p>
                            <button class="btn btn-primary mt-2" onclick="showAddProductModal()">
                                <i class="bi bi-plus-circle me-2"></i>Ajouter un produit
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = realProducts.map(product => `
                <tr>
                    <td>
                        <div><strong>${product.nom || product.name}</strong></div>
                        <small class="text-muted">${product.categorie || product.category || 'Non cat√©goris√©'}</small>
                    </td>
                    <td><code>${product.sku || 'N/A'}</code></td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                <div class="progress-bar ${getStockProgressClass(product.stock || 0, 5)}" 
                                     style="width: ${Math.min(((product.stock || 0) / 50) * 100, 100)}%">
                                </div>
                            </div>
                            <span>${product.stock || 0}</span>
                        </div>
                    </td>
                    <td>5</td>
                    <td>
                        <span class="stock-indicator ${getStockClass(product.stock || 0, 5)}">
                            <i class="bi ${getStockIcon(product.stock || 0, 5)}"></i>
                            ${getStockStatus(product.stock || 0, 5)}
                        </span>
                    </td>
                    <td>${formatDate(product.date_creation || new Date().toISOString())}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-2" 
                                onclick="updateRealStock('${product.id}')">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning" 
                                onclick="setLowStockAlertReal('${product.id}')">
                            <i class="bi bi-bell"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getStockProgressClass(stock, minStock) {
            if (stock <= minStock) return 'bg-danger';
            if (stock <= minStock * 2) return 'bg-warning';
            return 'bg-success';
        }

        function getStockStatus(stock, minStock) {
            if (stock <= minStock) return 'Stock faible';
            if (stock <= minStock * 2) return 'Stock moyen';
            return 'Stock bon';
        }

        function showLowStockAlert() {
            const lowStockProducts = realProducts.filter(p => (p.stock || 0) <= 5);
            
            if (lowStockProducts.length === 0) {
                showToast('Aucun produit en stock faible', 'info');
                return;
            }
            
            let alertMessage = 'Produits en stock faible:\n\n';
            lowStockProducts.forEach(product => {
                alertMessage += `‚Ä¢ ${product.nom || product.name}: ${product.stock || 0} unit√©s\n`;
            });
            
            alert(alertMessage);
        }

        function updateRealStock(productId) {
            const product = realProducts.find(p => p.id === productId);
            if (!product) return;
            
            const stock = prompt('Nouveau stock:', product.stock || 0);
            if (stock !== null && !isNaN(stock)) {
                product.stock = parseInt(stock);
                localStorage.setItem('senvision-products', JSON.stringify(realProducts));
                loadProductsGrid();
                loadInventoryTable();
                showToast('Stock mis √† jour', 'success');
            }
        }

        function setLowStockAlertReal(productId) {
            const product = realProducts.find(p => p.id === productId);
            if (!product) return;
            
            const newMinStock = prompt('D√©finir le stock minimum:', product.minStock || 5);
            if (newMinStock !== null && !isNaN(newMinStock)) {
                product.minStock = parseInt(newMinStock);
                localStorage.setItem('senvision-products', JSON.stringify(realProducts));
                loadInventoryTable();
                showToast('Stock minimum mis √† jour', 'success');
            }
        }

        function loadAnalyticsData() {
            const statsContainer = document.getElementById('analyticsStats');
            if (statsContainer) {
                const totalOrders = realOrders.length;
                const totalRevenue = realOrders.reduce((sum, order) => sum + (order.total || 0), 0);
                const totalCustomers = realCustomers.length;
                const totalProducts = realProducts.length;
                
                statsContainer.innerHTML = `
                    <div class="col-md-3 mb-4">
                        <div class="text-center">
                            <div class="stats-value text-primary">${totalOrders}</div>
                            <div class="stats-title">Commandes</div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="text-center">
                            <div class="stats-value text-success">${formatNumber(totalRevenue)} F</div>
                            <div class="stats-title">Revenu total</div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="text-center">
                            <div class="stats-value text-warning">${totalCustomers}</div>
                            <div class="stats-title">Clients actifs</div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="text-center">
                            <div class="stats-value text-info">${totalProducts}</div>
                            <div class="stats-title">Produits</div>
                        </div>
                    </div>
                `;
            }
            
            initAnalyticsCharts();
        }

        function initAnalyticsCharts() {
            const monthlyCtx = document.getElementById('monthlySalesChart');
            if (monthlyCtx && !charts.monthlySales) {
                const monthlySales = Array(12).fill(0);
                realOrders.forEach(order => {
                    const date = new Date(order.date || order.timestamp);
                    const month = date.getMonth();
                    monthlySales[month] += order.total || 0;
                });
                
                charts.monthlySales = new Chart(monthlyCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Ao√ª', 'Sep', 'Oct', 'Nov', 'D√©c'],
                        datasets: [{
                            label: 'Ventes (en FCFA)',
                            data: monthlySales,
                            borderColor: '#4361ee',
                            backgroundColor: 'rgba(67, 97, 238, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatNumber(value) + ' F';
                                    },
                                    font: {
                                        size: 9
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        size: 9
                                    }
                                }
                            }
                        }
                    }
                });
            }

            const topProductsCtx = document.getElementById('topProductsChart');
            if (topProductsCtx && !charts.topProducts) {
                const topProducts = realProducts.slice(0, 5);
                
                charts.topProducts = new Chart(topProductsCtx, {
                    type: 'bar',
                    data: {
                        labels: topProducts.map(p => (p.nom || p.name).substring(0, 12) + '...'),
                        datasets: [{
                            label: 'Stock',
                            data: topProducts.map(p => p.stock || 0),
                            backgroundColor: [
                                '#4361ee',
                                '#4895ef',
                                '#4cc9f0',
                                '#3a0ca3',
                                '#7209b7'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 5,
                                    font: {
                                        size: 9
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        size: 9
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function generateAnalyticsReport() {
            showToast('G√©n√©ration du rapport analytique...', 'info');
            
            const report = `
                RAPPORT ANALYTIQUE SENVISION OPTIQUE
                ============================================
                
                P√©riode: ${new Date().toLocaleDateString('fr-FR')}
                
                STATISTIQUES CL√âS:
                - Commandes totales: ${realOrders.length}
                - Ventes totales: ${formatNumber(realOrders.reduce((sum, order) => sum + (order.total || 0), 0))} FCFA
                - Clients actifs: ${realCustomers.length}
                - Produits en stock: ${realProducts.length}
                
                RAPPORT G√âN√âR√â LE: ${new Date().toLocaleString('fr-FR')}
            `;
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rapport-senvision-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Rapport t√©l√©charg√©', 'success');
        }

        // ============================================
        // FONCTIONS UTILITAIRES
        // ============================================
        function performGlobalSearch(query) {
            if (!query.trim()) return;
            showToast(`Recherche : "${query}"`, 'info');
        }

        function filterProducts() {
            showToast('Filtrage des produits', 'info');
        }

        function exportCustomers() {
            showToast('Export des clients en cours...', 'info');
            setTimeout(() => {
                showToast('Export CSV termin√©', 'success');
            }, 1000);
        }

        function exportAccounts(format) {
            showToast(`Export ${format} des comptes en cours...`, 'info');
            setTimeout(() => {
                showToast(`Export ${format} termin√©`, 'success');
            }, 1000);
        }

        function generateAccountsReport() {
            showToast('G√©n√©ration du rapport comptable...', 'info');
            setTimeout(() => {
                showToast('Rapport comptable g√©n√©r√© avec succ√®s', 'success');
            }, 1000);
        }
    </script>
</body>
</html>